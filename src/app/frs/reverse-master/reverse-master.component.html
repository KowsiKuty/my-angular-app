<div *ngIf="reverse_mas">
    <div *ngIf="!rev_cre" class="pr-5 pl-5 pt-3 pb-3">
        <h2 class="p-1">Reverse Branch</h2>

        <form [formGroup]="reverse_search">
            <!-- <div class="col-md-12"> -->
                <div class="row align-items-baseline">
                    <div class="col-md-auto">
                        <mat-form-field (click)="branchname()" appearance="outline" >
                            <mat-label>Branch</mat-label>
                            <input #branchInput placeholder="Branch" matInput formControlName="branch"
                                #branchContactInput [matAutocomplete]="branch" (keyup)="branchname()">
                            <mat-autocomplete #branch="matAutocomplete" [displayWith]="displaybranch"
                                (opened)="autocompletebranchnameScroll()">
                                <mat-option *ngIf="isLoading" class="is-loading">Loading...</mat-option>
                                <ng-container *ngIf="!isLoading">
                                    <mat-option *ngFor="let branch of branchList" [value]="branch">
                                        {{branch.code}}-{{branch.name}} </mat-option>
                                </ng-container>
                            </mat-autocomplete>
                        </mat-form-field>
                    </div>
                    <div class="col-md-auto">
                        <mat-form-field appearance="outline">
                            <mat-label>Type</mat-label>
                            <input #flagInput placeholder="Type" matInput formControlName="flag_search"
                              [matAutocomplete]="matAutocomplete_flag_search">
                            <mat-autocomplete #matAutocomplete_flag_search="matAutocomplete"
                                [displayWith]="display_flag">
                                    <mat-option *ngFor="let flag of flag_list" [value]="flag">
                                        {{flag.name}} </mat-option>
                            </mat-autocomplete>
                        </mat-form-field>
                    </div>
                    <div class="col-md-auto">
                        <mat-form-field (click)="employee_search_sum()" appearance="outline" >
                            <mat-label>Employee</mat-label>
                            <input #branchInput placeholder="Employee" matInput formControlName="employee_search"
                                #empsumInput [matAutocomplete]="emp_mat" (keyup)="branchname()">
                            <mat-autocomplete #emp_mat="matAutocomplete" [displayWith]="display_employee"
                                (opened)="autocompleteempScroll()">
                                <mat-option *ngIf="isLoading" class="is-loading">Loading...</mat-option>
                                <ng-container *ngIf="!isLoading">
                                    <mat-option *ngFor="let emp of empList" [value]="emp">
                                        {{emp.full_name}} </mat-option>
                                </ng-container>
                            </mat-autocomplete>
                        </mat-form-field>
                    </div>
                    <div class="col-md-auto">
                        <mat-form-field appearance="outline" (click)="status_function()">
                            <mat-label>Status</mat-label>
                            <mat-select formControlName="Status">
                                <mat-option *ngFor="let status of Status_list" [value]="status">
                                    {{status.name}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div class="col-md-auto">
                        <button type="submit" style="border-radius: 40px;" class="btn btn-outline-primary"
                        (click)="reversa_summary(reverse_search.value)">Search</button>
                    </div>
                    <div class="col-md-auto">
                        <button type="submit" style="border-radius: 40px;margin-left: 2%;" class="btn btn-outline-primary"
                        (click)="reverse_clear()">Reset</button>
                    </div>
                    <!-- <div class="col-md-auto" *ngIf="adding_btn">
                        <button type="submit" style="border-radius: 40px;margin-left: 2%;" class="btn btn-outline-primary"
                        (click)="reverse_create()">Add</button>
                    </div> -->
                    <div class="col-md-auto" *ngIf="maker_flow || maker_approver">
                        <button type="submit" style="border-radius: 40px;margin-left: 2%;" class="btn btn-outline-primary"
                        (click)="reverse_creates()">Add</button>
                    </div>
                </div>
            <!-- </div> -->
        </form>
        <mat-card class="mt-3">
            <form [formGroup]="reverse_grp">
                <table class="table table-bordered" id="commonstyle" fixed-header>
                    <thead style="background-color: #ddefdd;">
                        <th>S.No</th>
                        <th>Branch</th>
                        <th>Type</th>
                        <th>Employee</th> 
                        <th>Created Date</th>                          
                        <th>Status</th>
                        <th>History</th>
                        <th>Action</th>
                    </thead>
                    <tbody  *ngFor="let reverse_data of rev_summery;let i=index">
                        <tr>
                            <td>{{(presentpage_sum - 1)*10 + i+1 }}</td>
                            <td>{{reverse_data.branch.code}}-{{reverse_data.branch.name}}</td>
                            <td>{{reverse_data.flag.name}}</td>
                            <td>{{reverse_data.employee.code}}-{{reverse_data.employee.full_name}}</td>
                            <td>{{reverse_data.createdate}}</td>
                            <td>{{ reverse_data.status === 1 ? 'Pending' : reverse_data.status === 2 ? 'Approved' : reverse_data.status === 3 ? 'Rejected' : '' }}
                            </td>
                            <td><button mat-icon-button color="primary" style="margin-left: 5%;" matTooltip="History" (click)="History_fetch(reverse_data,1)" data-toggle="modal" data-target="#exampleModal1">
                                <mat-icon>description</mat-icon>
                            </button></td>
                            <td *ngIf="maker_flow ">
                                <button *ngIf="reverse_data.status == 1" mat-icon-button class="material-icons app-toolbar-menu save-button"
                                         matTooltip="Edit" style="color:'#499608'"
                                        (click)="reverse_edit(reverse_data,i)">
                                        <mat-icon>edit</mat-icon>
                                    </button>

                                    <button *ngIf="reverse_data.status == 1" mat-icon-button class="material-icons app-toolbar-menu delete-button"
                                        (click)="reverse_delete(reverse_data,i)" 
                                        [matTooltip]="reverse_data.exp_status == 0 ? 'Delete' : 'Delete' "
                                        color="warn">
                                        <mat-icon>delete</mat-icon>
                                    </button>
                                    <button mat-icon-button matTooltip="view"  class="iconbutton" color="primary" style="color: green;" (click)="file_view(reverse_data)">
                                    <mat-icon class="enabled_icon" aria-label="view">visibility</mat-icon>
                                </button>
                            </td>
                            <td *ngIf="Approver_flow">
                                <button *ngIf="reverse_data.status == 1 "  mat-icon-button matTooltip="Approve" class="iconbutton" color="primary" style="color: green;" (click)="approve_rec(reverse_data)" data-toggle="modal" data-target="#exampleModal2">
                                    <mat-icon class="enabled_icon" aria-label="approve">check_circle</mat-icon>
                                </button>
                                <button *ngIf="reverse_data.status == 1" mat-icon-button matTooltip="Reject" class="iconbutton" color="primary" style="color: red;" (click)="reject_rec(reverse_data)" data-toggle="modal" data-target="#exampleModal3">
                                    <mat-icon class="enabled_icon" aria-label="approve">cancel</mat-icon>
                                </button>
                                <button mat-icon-button matTooltip="view"  class="iconbutton" color="primary" style="color: green;" (click)="file_view(reverse_data)">
                                    <mat-icon class="enabled_icon" aria-label="view">visibility</mat-icon></button>
                            </td>
                            <td *ngIf="maker_approver">
                                 <button *ngIf="reverse_data.status == 1 " [disabled]="reverse_data?.approvepermission !== true" mat-icon-button class="material-icons app-toolbar-menu save-button"
                                         matTooltip="Edit" style="color:'#499608'"
                                        (click)="reverse_edit(reverse_data,i)">
                                        <mat-icon>edit</mat-icon>
                                    </button>
                                <button *ngIf="reverse_data.status == 1 "  [disabled]="reverse_data?.approvepermission == true"
 mat-icon-button matTooltip="Approve" class="iconbutton" color="primary" style="color: green;" (click)="approve_rec(reverse_data)" data-toggle="modal" data-target="#exampleModal2">
                                    <mat-icon class="enabled_icon" aria-label="approve">check_circle</mat-icon>
                                </button>
                                <button *ngIf="reverse_data.status == 1" mat-icon-button matTooltip="Reject" class="iconbutton" color="primary" style="color: red;" (click)="reject_rec(reverse_data)" data-toggle="modal" data-target="#exampleModal3">
                                    <mat-icon class="enabled_icon" aria-label="approve">cancel</mat-icon>
                                </button>
                                <button mat-icon-button matTooltip="view"  class="iconbutton" color="primary" style="color: green;" (click)="file_view(reverse_data)">
                                    <mat-icon class="enabled_icon" aria-label="view">visibility</mat-icon></button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </form>
            <div style="margin-bottom: 5%;font-size: small;text-align:right;">
                <button mat-icon-button [disabled]="has_previous_sum === false" color="primary"
                    (click)="previousClick()">
                    <mat-icon>arrow_back</mat-icon>
                </button> {{presentpage_sum}}
                <button mat-icon-button [disabled]="has_next_sum === false" color="primary" (click)="nextClick()">
                    <mat-icon>arrow_forward</mat-icon>
                </button>
            </div>
        </mat-card>
    </div>
<!-- </div> -->

 <!-- <div class="modal fade" id="exampleModal2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel2"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content" style="width: 900px;margin-left: -30%;">
            <div class="modal-header" style="width: 900px; ">
                <h5 class="modal-title" id="exampleModalLabel" style="text-align: center; font-size: large;">
                    <b>Remarks</b>
                </h5>
                <button type="button" class="close" data-dismiss="modal" #closepopup aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form [formGroup]="File_upload">
                    <div style="margin-left: 50px;width:90%;height: 100%;">
                        <div>
                            <input style="width: 40%;" type="file" multiple (change)="fileupload($event)"  formControlName="documentfile"/>                         
                        </div>
                        <div *ngIf="uploadedFiles.length > 0" style="margin-top: 5px;">
                            <div *ngFor="let file of uploadedFiles; let i = index">
                              <span style="flex-grow: 1;">{{ file.name }}</span>
                              <button mat-icon-button color="warn" (click)="removeFile(i)">
                                <mat-icon>delete</mat-icon>
                              </button>
                            </div>
                          </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <!-- <button mat-raised-button color="primary" (click)="file_submit">
                    <mat-icon>check_circle</mat-icon>
                    Submit
                </button> -->
                 <!-- <button mat-raised-button style="margin-left: 5%;" color="primary" data-dismiss="modal">
                    <mat-icon>Submit</mat-icon>
                    Submit
                </button> 
                <button mat-raised-button style="margin-left: 5%;" color="primary" data-dismiss="modal">
                    <mat-icon>close</mat-icon>
                    Close
                </button>
            </div>
        </div>
    </div>
</div> -->



<div class="modal fade" id="exampleModal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel2"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content" style="width: 900px;margin-left: -30%;">
            <div class="modal-header" style="width: 900px; ">
                <h5 class="modal-title" id="exampleModalLabel" style="text-align: center; font-size: large;">
                    <b>Reverse branch history</b>
                </h5>
                <button type="button" class="close" data-dismiss="modal" #closepopups aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form [formGroup]="File_upload">
                    <div style="width:100%;height: 100%;">
                        <table class="table table-bordered" id="commonstyle" fixed-header>
                            <thead style="background-color: #ddefdd;">
                                <th>S.No</th>
                                <th>Employee</th>
                                <th>Action Date</th>
                                <th>Status</th>
                                <th>Remarks</th>                                
                            </thead>
                            <tbody *ngFor="let his of history_data;let i=index">
                                <tr>
                                    <td>{{(presentpagess-1)*10+i + 1 }}</td>
                                    <td>{{his.employee.code}}-{{his.employee.full_name}}</td>
                                    <td>{{his.createdate}}</td>
                                    <td>{{ his.status === 1 ? 'Created' : his.status === 2 ? 'Approved' : his.status === 3 ? 'Rejected' : '' }}</td>
                                    <td>{{his.remarks || '--'}}</td>
                                </tr>
                                
                            </tbody>
                        </table>
                        <p style="text-align: center;" *ngIf="!datass_foundss">No data Found...</p>                        
                    </div>
                    <div style="margin-bottom: 5%;font-size: small;text-align:right;">
                        <button mat-icon-button [disabled]="has_previousss === false" color="primary"
                            (click)="previousClicks()">
                            <mat-icon>arrow_back</mat-icon>
                        </button> {{presentpagess}}
                        <button mat-icon-button [disabled]="has_nextss === false" color="primary" (click)="nextClicks()">
                            <mat-icon>arrow_forward</mat-icon>
                        </button>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-dark" data-dismiss="modal">
                    Close
                </button>
            </div>
        </div>
    </div>
</div> 
<div class="modal fade" id="exampleModal2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel2"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content" style="width: 900px;margin-left: -30%;">
            <div class="modal-header" style="width: 900px; ">
                <h5 class="modal-title" id="exampleModalLabel" style="text-align: center; font-size: large;">
                    <b>Reverse branch Approve</b>
                </h5>
                <button type="button" class="close" data-dismiss="modal" #closepopupssss aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form [formGroup]="approve_remark">
                    <div class="col-md-3">
                        <mat-form-field style="width: 180px;">
                            <mat-label>Remarks</mat-label>
                            <input matInput placeholder="" formControlName="remarkss" autocomplete="off">
                        </mat-form-field>
                    </div>
                </form>                
            </div>
            <div class="modal-footer">
                <div class="col-md-auto">
                    <button type="submit" style="border-radius: 40px;margin-left: 2%;" class="btn btn-outline-primary"
                    (click)="approve_action(approve_data,2)">Approve</button>
                </div>
                <div class="col-md-auto">
                    <button type="submit" data-dismiss="modal" style="border-radius: 40px;margin-left: 2%;" class="btn btn-outline-primary"
                    >Close</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="exampleModal3" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel2"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content" style="width: 900px;margin-left: -30%;">
            <div class="modal-header" style="width: 900px; ">
                <h5 class="modal-title" id="exampleModalLabel" style="text-align: center; font-size: large;">
                    <b>Reverse branch Reject</b>
                </h5>
                <button type="button" class="close" data-dismiss="modal" #closepopupss aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form [formGroup]="approve_reject">
                    <div class="col-md-3">
                        <mat-form-field style="width: 180px;">
                            <mat-label>Remarks</mat-label>
                            <input matInput placeholder="" formControlName="remarksss" autocomplete="off">
                        </mat-form-field>
                    </div>
                </form>                
            </div>
            <div class="modal-footer">
                <div class="col-md-auto">
                    <button type="submit" style="border-radius: 40px;margin-left: 2%;" class="btn btn-outline-primary"
                    (click)="approve_action(reject_data,3)">Reject</button>
                </div>
                <div class="col-md-auto">
                    <button type="submit" data-dismiss="modal" style="border-radius: 40px;margin-left: 2%;" class="btn btn-outline-primary"
                    >Close</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div *ngIf="rev_cre" class="pr-5 pl-5 pt-3 pb-3">
    <form [formGroup]="reverse_create">
            <div class="row align-items-baseline">
                <div class="col-md-auto">
                    <mat-form-field (click)="branchnames()">
                        <mat-label>Branch</mat-label>
                        <input #branchInput [readonly]="isRemarkDisabled" placeholder="Branch" matInput formControlName="branchs"
                            #branchContactInputs [matAutocomplete]="branchs" (keyup)="branchname()">
                        <mat-autocomplete #branchs="matAutocomplete" [displayWith]="displaybranchs"
                            (opened)="autocompletebranchnameScrolls()">
                            <mat-option *ngIf="isLoading" class="is-loading">Loading...</mat-option>
                            <ng-container *ngIf="!isLoading">
                                <mat-option *ngFor="let branchs of branchLists" [value]="branchs">
                                    {{branchs.code}}-{{branchs.name}} </mat-option>
                            </ng-container>
                        </mat-autocomplete>
                    </mat-form-field>
                </div>
                <div class="col-md-auto">
                    <mat-form-field>
                        <mat-label>Type</mat-label>
                        <input #flagInput placeholder="Type" [readonly]="isRemarkDisabled" matInput formControlName="flag_searchs"
                          [matAutocomplete]="matAutocomplete_flag_search">
                        <mat-autocomplete #matAutocomplete_flag_search="matAutocomplete"
                            [displayWith]="display_flag">
                                <mat-option *ngFor="let flag of flag_list" [value]="flag" (click)="Selectvalue_type($event,flag)">
                                    {{flag.name}} </mat-option>
                        </mat-autocomplete>
                    </mat-form-field>
                </div>
                <div class="col-md-auto" *ngIf="emp_bra">
                    <mat-form-field (click)="employee_search_sums()">
                        <mat-label>Employee</mat-label>
                        <input #branchInput placeholder="Employee" [readonly]="isRemarkDisabled" matInput formControlName="employee_searchs"
                            #empsumInputs [matAutocomplete]="emp_mats" (keyup)="branchname()">
                        <mat-autocomplete #emp_mats="matAutocomplete" [displayWith]="display_employee"
                            (opened)="autocompleteempScrolls()">
                            <mat-option *ngIf="isLoading" class="is-loading">Loading...</mat-option>
                            <ng-container *ngIf="!isLoading">
                                <mat-option *ngFor="let emps of empLists" [value]="emps">
                                    {{emps.full_name}} </mat-option>
                            </ng-container>
                        </mat-autocomplete>
                    </mat-form-field>
                </div>
                <div class="col-md-auto" *ngIf="upload_file">
                    <div>
                        <input style="width: 80%;" type="file" multiple (change)="fileupload($event)"  formControlName="documentfile"/>                         
                    </div>
                    <div *ngIf="uploadedFiles.length > 0" style="margin-top: 5px;">
                        <mat-card>
                            <div *ngFor="let file of uploadedFiles; let i = index">
                                <span style="flex-grow: 1;">{{ file.name }}</span>
                                <button mat-icon-button color="warn" (click)="removeFile(i)">
                                <mat-icon>delete</mat-icon>
                                </button>
                            </div>
                        </mat-card>
                        
                    </div>
                </div>
                <div class="col-md-auto" *ngIf="upload_files">
                    <!-- <div >
                        <input style="width: 80%;" type="file" multiple (change)="fileupload($event)"  formControlName="documentfiles"/>                         
                    </div> -->
                    <div style="margin-top: 5px;">
                        <mat-card>
                            <div *ngIf="uploadedFiles.length!== 0 || uploadedFiles">
                                <div *ngFor="let file of uploadedFiles; let i = index">
                                    <span style="flex-grow: 1;">{{ file.file_name?file.file_name: 'No Files Upload'}}</span>
                                    <!-- <span style="flex-grow: 1;">  {{ file.file_name && file.file_name.trim() ? file.file_name : 'No files uploaded' }}
                                        </span> -->
                                    <button mat-icon-button color="primary" style="color: green;" (click)="download_file(file,i)">
                                    <mat-icon>download</mat-icon>
                                    </button>
                                </div>
                            </div>
                            
                            <div *ngIf="uploadedFiles.length=== 0 || !uploadedFiles">{{'No Files Upload'}}</div>
                        </mat-card>                        
                    </div>
                </div>
                <div class="col-md-3" *ngIf="upload_filess">
                    <mat-form-field style="width: 180px;">
                        <mat-label>Remarks</mat-label>
                        <input matInput placeholder="" [readonly]="isRemarkDisabled" formControlName="remark" autocomplete="off">
                    </mat-form-field>
                </div>
                <div class="col-md-auto">
                    <button type="submit" [hidden]="!btn_view" style="border-radius: 40px;margin-left: 2%;" class="btn btn-outline-primary"
                    (click)="reverse_clears()">Reset</button>
                </div>
                <div class="col-md-auto" >
                    <button [hidden]="!btn_view" type="submit" style="border-radius: 40px;margin-left: 2%;" class="btn btn-outline-primary"
                    (click)="reverse_submit(reverse_create.value)">Submit</button>
                </div>
                <div class="col-md-auto">
                    <button  type="submit" style="border-radius: 40px;margin-left: 2%;" class="btn btn-outline-primary"
                    (click)="reverse_back()">Back</button>
                </div>
            </div>
        <!-- </div> -->
    </form>

</div>



<div>
  <div>
    <h2 style="margin-left: 44px;margin-top: 30px; font-size: 22px;font-weight: 500;">
      eClaim Local Deputation Expense
    </h2>
  </div>
  <div *ngIf="isonbehalf">
    <h3 style="margin-left: 44px;color:rgb(0, 0, 0);font-size: 18px; font-weight: 400;">
      On Behalf Employee - {{onbehalf_empName}}
    </h3>
  </div>
  <hr>
  <div style="margin-left: 50px;margin-top: 3%;margin-bottom: 50px;">
    <h3 style="color:rgb(0, 0, 0);font-size: 18px; font-weight: 500;">
      Tour Details
    </h3>
    <div>
      <form [formGroup]="deputationform">
        <table>
          <tr>
            <td>
              <mat-form-field style="width: 175px;">
                <mat-label style="font-size: 20px;">Tour No</mat-label>
                <input matInput class="disabled11" placeholder="Tour No" formControlName="requestno" [readonly]="true">
              </mat-form-field>
            </td>
            <td>
              <mat-form-field style="width: 175px;margin-left: 50px;">
                <mat-label style="font-size: 20px;">Employee Name</mat-label>
                <input matInput class="disabled11" placeholder="Employee Name" formControlName="employeename"
                  [readonly]="true">
              </mat-form-field>
            </td>
            <td>
              <mat-form-field style="width: 175px;margin-left: 50px;">
                <mat-label style="font-size: 20px;">Designation</mat-label>
                <input matInput class="disabled11" placeholder="Designation" formControlName="designation"
                  [readonly]="true">
              </mat-form-field>
            </td>
            <td>
              <mat-form-field style="width: 175px;margin-left: 50px;">
                <mat-label style="font-size: 20px;">Employee Grade</mat-label>
                <input class="disabled11" matInput placeholder="Employee Grade" formControlName="employeegrade"
                  [readonly]="true">
              </mat-form-field>
            </td>
            <td>

              <button type="button" class="btn btn-outline-success" (click)="adddata()"
                style="border-radius:40px;margin-left: 50px" *ngIf="!approver"><span class="fa fa-plus"></span>
                ADD</button>

            </td>
          </tr>
        </table>
        <div style="width:98%;margin-top: 1%;">
          <table class="table table-bordered table-responsive" style="width: 99%;margin-top: 10px;">
            <tr class="table_header" style="text-align: left;">
              <th>S.No</th>
              <th>City</th>
              <th>From Date</th>
              <th>To Date</th>
              <th>System Calculated No of Days</th>
              <th>No of Days</th>
              <th>No of Leave Days</th>
              <th>Eligible Amount</th>
              <th>Claim Amount</th>
              <th *ngIf="!approver">Action</th>
              <th *ngIf="approver && applevel == 2">Approve Amount</th>
            </tr>
            <tbody formArrayName="data"
              *ngFor="let item of deputationform.get('data')['controls'] | paginate: { itemsPerPage: pageSize, currentPage: p } index as i">
              <tr [formGroupName]="GlobalIndex(i)">
                <td>{{((p-1)*pageSize)+i+1}}</td>
                <td>
                  <fieldset [disabled]="approver">
                    <mat-form-field floatLabel="never">

                      <!-- <mat-label>City</mat-label>
                      <input (keypress)="citysearch(i)" type="text" required #inputassetid placeholder="Select City"
                        matInput (keypress)="omit_special_char($event)" [matAutocomplete]="conoffice"
                        formControlName="city">
                      <mat-autocomplete #assetid #conoffice="matAutocomplete" (opened)="autocompleteid()">
                        <mat-option *ngFor="let city of citylist" (click)="cityselectcall(i)" [value]="city.city">
                          {{city.city}}

                        </mat-option>
                      </mat-autocomplete> -->
              

                        <mat-label>City</mat-label>
                        <input (keypress)="citysearch(i)" type="text" required #inputassetid placeholder="Select City"
                          matInput (keypress)="omit_special_char($event)" [matAutocomplete]="conoffice"
                          formControlName="city">
                        <mat-autocomplete #assetid #conoffice="matAutocomplete" (opened)="autocompleteid()">
                          <mat-option *ngFor="let city of citylist" (click)="cityselectcall(i)" [value]="city.city">
                            {{city.city}}
    
                          </mat-option>
                        </mat-autocomplete>
                     
                    </mat-form-field>
                  </fieldset>
                </td>
                <td>
                  <fieldset [disabled]="approver">
                    <mat-form-field floatLabel="never">
                      <input matInput readonly [matDatepicker]="picker1" required [min]="minselect(i)" [max]="maximum"
                        placeholder="From Date" (dateChange)="cityselectcall(i);invaliddatestart(i)" autocomplete="off"
                        formControlName="startdate" aria-readonly="true">
                      <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
                      <mat-datepicker #picker1></mat-datepicker>
                    </mat-form-field>
                  </fieldset>
                </td>
                <td>
                  <fieldset [disabled]="approver">
                    <mat-form-field floatLabel="never">
                      <input matInput readonly [matDatepicker]="picker2" required [min]="maxselect(i)" [max]="maximum"
                        placeholder="To Date" autocomplete="off" (dateChange)="cityselectcall(i);invaliddateend(i)"
                        formControlName="enddate" aria-readonly="true">
                      <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
                      <mat-datepicker #picker2></mat-datepicker>
                    </mat-form-field>
                  </fieldset>
                </td>
                <td>
                  <fieldset [disabled]="approver">
                    <mat-form-field floatLabel="never" class="disabled11">
                      <input matInput placeholder="System No of Days" readonly formControlName="sysdays">
                    </mat-form-field>
                  </fieldset>
                </td>
                <td>
                  <fieldset [disabled]="approver">
                    <mat-form-field floatLabel="never">
                      <input matInput required placeholder="No of Days" (keydown)="nospace($event);zero($event)"
                        (keypress)="keyPressAmounts($event)" (change)="cityselectcall(i)" formControlName="no_of_days">
                    </mat-form-field>
                  </fieldset>
                </td>
                <td>
                  <fieldset [disabled]="approver">
                    <mat-form-field floatLabel="never">
                      <input matInput placeholder="Leave" (keydown)="nospace($event);zero($event)"
                        (keypress)="keyPressAmounts($event)" required (change)="cityselectcall(i)"
                        formControlName="leave">
                    </mat-form-field>
                  </fieldset>
                </td>
                <td>
                  <fieldset [disabled]="approver">
                    <mat-form-field floatLabel="never" class="disabled11">
                      <input matInput placeholder="Eligible Amount" formControlName="eligibleamount">
                    </mat-form-field>
                  </fieldset>
                </td>
                <td>
                  <fieldset [disabled]="approver">
                    <mat-form-field floatLabel="never">
                      <input matInput required placeholder="Enter Amount" appNumberOnly formControlName="claimedamount">
                    </mat-form-field>
                  </fieldset>
                </td>
                <td *ngIf="!approver">
                  <button mat-icon-button [disabled]="deputationform.get('data')['controls'].length== 1"
                    (click)="indexdelete(i)">
                    <mat-icon style="color:red">delete</mat-icon>
                  </button>
                </td>
                <td *ngIf="approver && applevel == 2">
                  <fieldset [disabled]="statusid > 2">
                    <mat-form-field floatLable="never">
                      <input matInput (keypress)="keyPressAmounts($event);zero($event)"
                        formControlName="approvedamount">
                    </mat-form-field>
                  </fieldset>
                </td>

              </tr>
            </tbody>
          </table>
          <div class="pagination">
            <pagination-controls responsive="true" (pageChange)="p = $event"></pagination-controls>
          </div>
        </div>

        <div class="col-md-12 text-center" style="margin-top: 50px;">
          <button *ngIf='!approver' type="submit" style="border-radius: 40px;margin-left: 10px;" (click)="submit()"
            class="btn btn-outline-success"
            [disabled]="deputationform.get('data')['controls'].length== 0">Submit</button>

          <button *ngIf='applevel == 2 && statusid == 2' style="border-radius: 40px;margin-left: 10px;"
            class="btn btn-outline-primary" (click)="getupdateapprove()"> Approve </button>
          <button type="button" class="btn btn-outline-primary" (click)="back()"
            style="border-radius: 40px;margin-left: 10px;">Back</button>
        </div>
      </form>
    </div>
  </div>
</div>
<ngx-spinner bdColor="rgba(0, 0, 0, 1.5)" size="default" type="la-ball-scale-multiple la-3x">
  <p style="color: white">Please Wait. </p>
</ngx-spinner>
<!-- <div *ngIf="firstscreen"> -->
  <div  *ngIf="firstscreen" style="margin-left: 15px;margin-top: 15px;">
    <h3 style="color:black;font-size: 20px;font-weight: 500">
        eClaim AP User Summary
    </h3>

    <form [formGroup]="summaryForm">
        <div class="row">
            <div class="col-md-3">
                <mat-form-field>
                    <mat-label>Tour NO</mat-label>
                    <input matInput [formControlName]="'tourno'"
                    type="number" #inputRef (keydown)="onKeyDown($event)"
                    >
                </mat-form-field>
                <br>
                <mat-form-field>
                    <mat-label>Requested Date</mat-label>
                    <input readonly [matDatepicker]="picker1" matInput [formControlName]="'requestdate'">
                    <mat-datepicker #picker1></mat-datepicker>
                    <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
                </mat-form-field>
            </div>
            <div class="col-md-4">
                <mat-form-field>
                    <mat-label>Branch</mat-label>
                    <input matInput [matAutocomplete]="branchDropdown" [formControlName]="'branch'" (keypress)="omit_special_char($event)">
                    <mat-autocomplete #branchDropdown [displayWith]="Display" >
                        <mat-option [value]="branch" *ngFor="let branch of branchList">
                            {{branch.name}}
                        </mat-option>
                    </mat-autocomplete>
                </mat-form-field>
                <br>
                <mat-form-field>
                    <mat-label>Employee</mat-label>
                    <input matInput [formControlName]="'employee'">
                </mat-form-field>
                <button type="button" matTooltip="Add" class="btn btn-outline-success" (click)="createapuser()" style="border-radius:40px;margin-left:3%;"><span
                    class="fa fa-plus"></span></button>
            </div>
            <div class="col-md-4">
                <mat-form-field>
                    <mat-label>Status</mat-label>
                    <mat-select [formControlName]="'status'">
                        <mat-option [value]="status.id" *ngFor="let status of statusList">
                            {{status.name}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
                <button class="btn btn-outline-success" type="submit" matTooltip="Search"
                    style="border-radius:40px;" id="tasumspace" color="primary" (click)="tourApproverapSearch()"><i class="fa fa-search"
                        aria-hidden="true"></i></button>

                <button class="btn btn-outline-success"  type="submit" (click)="resetap()"
                    style="border-radius:40px;margin-left: 15px;" color="primary">Clear</button>
            </div>
        </div>
    </form>
    <table class="table table-bordered" fixed-header style="width: 100%;margin-top: 10px;">
        <thead class="table_header" style="text-align: left;">
    <tr>
    <th>S.No</th>
    <th>Tour No</th>
    <th>Tour Request Date</th>
    <th style="width: 8%;">Tour Start Date</th>
    <th  style="width: 8%;">Tour End Date</th>
    <th>Tour Reason</th>
    <th>Branch </th>
    <th>Employee</th>
    <th>Approver</th>
    <th>Status</th>
    <th>Expense Details</th>
    
    </tr>
    </thead>
    <tbody> 
        <tr *ngFor="let tourapuser of getapuserList; index as i">
       <td scope="row"  style="vertical-align: middle;">{{(this.currentpage - 1)*pagesize +i+1 }}</td>
       
        <td>{{tourapuser.requestno}}</td>
        <td>{{tourapuser.requestdate}}</td>
        <td>{{tourapuser.start_date}}</td>
        <td>{{tourapuser.end_date}}</td>
        <td>{{tourapuser.reason}}</td>
        <td>({{tourapuser.empbranchgid.code}}) {{tourapuser.empbranchgid.name}}</td>
        <td>({{tourapuser.empgid.code}}) {{tourapuser.empgid.full_name}}</td>
        <td *ngIf="tourapuser.empgid.code"> ({{tourapuser.empgid.code}}) {{tourapuser.empgid.full_name}}</td>
        <td *ngIf="tourapuser.empgid.code == null"></td>
        <td>
            <p *ngIf="tourapuser.claim_status == 1">
                Claim created</p>
    
                <p *ngIf="tourapuser.claim_status == 3 && tourapuser.max_applevel== 1">
                Tour claim Forwarder Approved</p>
    
                <p *ngIf="tourapuser.claim_status == 4  && tourapuser.max_applevel== 1">
                    Tour claim Rejected from Forwarder</p>
    
                  <p *ngIf="tourapuser.claim_status == 2 && tourapuser.max_applevel== 1">
                  Tour Claim Submitted To Forwarder</p>
    
                  <p *ngIf="tourapuser.claim_status == 5 && tourapuser.max_applevel== 1">
                    Tour Claim Returned from Forwarder</p>
    
                <p *ngIf="tourapuser.claim_status == 4  && tourapuser.max_applevel== 2">
                  Tour claim Rejected from Approver</p>
    
                <p *ngIf="tourapuser.claim_status == 2 && tourapuser.max_applevel== 2">
                Tour Claim Submitted To Approver</p>
    
                <p *ngIf="tourapuser.claim_status == 5 && tourapuser.max_applevel== 2">
                  Tour Claim Returned from Approver</p>
    
                  <p *ngIf="tourapuser.claim_status == 3 && tourapuser.max_applevel== 2">
                    Tour claim Approver Approved</p>

        </td>
        <td><button mat-icon-button matTooltip=" Edit" class="iconbutton" color="primary">
            <!-- (click)="expenceEdit(tourexpence)"> -->
            
            <mat-icon style="color:green;" aria-label="Edit">edit</mat-icon>
        </button>
        </td>
            
        </tr>
    </tbody>
    </table>
    <div class="row">
        <div class="col-sm-12" style="font-size: small;text-align:right;margin-bottom: 5%;">
            <button mat-icon-button [disabled]="has_previous === false" color="primary"
            (click)="TourapuserpreviousClick()">
            <mat-icon >arrow_back</mat-icon>
            </button>
            {{currentpage}}
            <button mat-icon-button [disabled]="has_next === false" color="primary"
            (click)="TourapusernextClick()">
            <mat-icon >arrow_forward</mat-icon>
            </button>
            </div>
    </div>
</div>
<!-- </div> -->
<!-- <div   *ngIf="createsummary" style="margin-left: 15px;max-width: fit-content;margin-top: 15px;">
        <h3 style="color:black;font-size: 20px;font-weight: 500" >
            eClaim AP User Maker Summary
       </h3><br>
        <div class="row">
            <div class="col-12">
                <form [formGroup]="tourApprovalSearchForm">
                    <mat-form-field style="width:175px;">
                        <mat-label>Tour No</mat-label>
                        <input matInput placeholder="Tour No" formControlName="tourno"
                        type="number" #inputRef (keydown)="onKeyDown($event)">
                    </mat-form-field>
                   
                        <mat-form-field style="width:210px;" id="tasumspace">
                            <mat-label>Tour Requested Date</mat-label>
                            <input matInput readonly [matDatepicker]="picker1" 
                                    placeholder="Request Date" autocomplete="off" formControlName="requestdate">
                                    <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
                                    <mat-datepicker #picker1></mat-datepicker>
                      </mat-form-field>
                  
                    
                    <button class="btn btn-outline-success" matTooltip="Search" type="submit"  (click)="tourApproverSearch()" style="border-radius:40px;" id="tasumspace"
                                color="primary"><i class="fa fa-search" aria-hidden="true"></i></button>
    
                    <button class="btn btn-outline-success" matTooltip="clear" type="submit"(click)="reset()" style="border-radius:40px;margin-left: 15px;"
                    color="primary">Clear</button>
    
                </form>
            </div>
        </div>
        <table class="table table-bordered" fixed-header style="width: 99%;margin-top: 10px;">
            <thead class="table_header" style="text-align: left;">
        <tr>
        <th>S.No</th>
        <th>Tour No</th>
        <th>Tour Requested Date</th>
        <th>From Date</th>
        <th>To Date</th>
        <th>Tour Reason</th>
        <th>Employee</th>
        <th>Branch</th>
        <th>Raised By</th>
        <th>Employee Grade</th>
        <th>Claim Amount</th>
        <th>Status</th>
        <th>Action</th>
        
        </tr>
        </thead>
        <tbody> 
            <tr *ngFor="let approvexpence of getapprovexpenceList; index as i">
           <td scope="row"  style="vertical-align: middle;">{{(getapprovesumm_currentpage - 1)*pagesize +i+1 }}</td>
            <td>{{approvexpence.tourid}}</td>
            <td>{{approvexpence.requestdate}}</td>
            <td>{{approvexpence.startdate}}</td>
            <td>{{approvexpence.approveddate}}</td>
            <td>{{approvexpence.reason}}</td>
            <td>({{approvexpence.employee_code}}) {{approvexpence.employee_name}}</td>
            <td>({{approvexpence.branch_code}}) {{approvexpence.branch_name}}</td>
            <td>({{approvexpence?.onbehalfof?.code}}) {{approvexpence?.onbehalfof?.full_name}}</td>
            <td>{{approvexpence.empgrade}}</td>
            <td>{{approvexpence.claim_amount | currency:"INR"}}</td>
            <td><p *ngIf="approvexpence.claim_status_id == 1">
                Tour Claim Requested</p>
    
                <p *ngIf="approvexpence.claim_status_id == 3 && approvexpence.applevel== 1">
                Tour Claim Forwarder Approved</p>
    
                <p *ngIf="approvexpence.claim_status_id == 4  && approvexpence.applevel== 1">
                    Tour Claim Rejected from Forwarder</p>
    
                  <p *ngIf="approvexpence.claim_status_id == 2 && approvexpence.applevel== 1">
                  Tour Claim Submitted To Forwarder</p>
    
                  <p *ngIf="approvexpence.claim_status_id == 5 && approvexpence.applevel== 1">
                    Tour Claim Returned from Forwarder</p>
    
                <p *ngIf="approvexpence.claim_status_id == 4  && approvexpence.applevel== 2">
                  Tour Claim Rejected from Checker</p>
    
                <p *ngIf="approvexpence.claim_status_id == 2 && approvexpence.applevel== 2">
                Tour Claim Verified and Submitted To Checker</p>
    
                <p *ngIf="approvexpence.claim_status_id == 5 && approvexpence.applevel== 2">
                  Tour Claim Returned from Checker</p>
    
                  <p *ngIf="approvexpence.claim_status_id == 3 && approvexpence.applevel== 2">
                    Tour claim verified and Checker Approved</p>
              </td>
            <td><button mat-icon-button matTooltip="View" class="iconbutton" color="primary"
                (click)="approveexpenceEdit(approvexpence)">
                
                <mat-icon style="color: green;"class="material-icons">
                    visibility</mat-icon>
            </button>
            </td>
                
            </tr>
        </tbody>
        </table>
        <div *ngIf="getapprovexpenceList ?.length == 0;else pagination" style="margin-left: 42%;">
            <h3>Sorry data not found!.. </h3>
        </div>
        <ng-template #pagination>
        <div class="row" >
            <div class="col-sm-12" style="font-size: small;text-align:right;margin-bottom: 5%;">
                <button mat-icon-button [disabled]="has_previous === false" color="primary"
                (click)="TourapprovepreviousClick()">
                <mat-icon >arrow_back</mat-icon>
                </button>
                {{getapprovesumm_currentpage}}
                <button mat-icon-button [disabled]="has_next === false" color="primary"
                (click)="TourapprovenextClick()">
                <mat-icon >arrow_forward</mat-icon>
                </button>
                </div>
        </div>
      </ng-template>
</div> -->


<!-- eClaim AP User Screen screen cmd date 7-11-2023-->
<div id="tamain" *ngIf="secondscreen" >


    <h3 style="margin-left: 44px;margin-top: 30px; font-size: 22px;font-weight: 500;">
      eClaim AP User Screen({{crnumber}})
    </h3>
    <hr>
    <div  style="margin-left: 50px;margin-top: 2%; width: 100%;"> 
      <h3 style="color:rgb(0, 0, 0);font-size: 18px;font-weight: 500px;margin-top: 1%;">
        Tour Details
      </h3>
      <form [formGroup]="expenceform">
        <div>
    
          <table>
            <tr>
              <td>
                <mat-form-field style="width: 175px;">
                  <mat-label>Tour No</mat-label>
                  <input matInput placeholder="Tour No" name="requestno" [value]="tourgid" [disabled]="true"
                    autocomplete="off" required>
                </mat-form-field>
              </td>
              <td>
                <mat-form-field style="width:250px;padding-left: 50px;">
                  <mat-label>Tour Reason</mat-label>
                  <input matInput placeholder="Tour Reason" name="reason" [value]="reason" [disabled]="true"
                    autocomplete="off" required>
                </mat-form-field>
              </td>
              <td>
                <mat-form-field style="width: 175px;padding-left: 50px;">
                  <mat-label>Start Date</mat-label>
                  <input matInput placeholder="Start Date" name="startdate" [value]="startdate" [disabled]="true"
                    autocomplete="off" required>
                </mat-form-field>
              </td>
              <td>
                <mat-form-field style="width: 175px;margin-left: 50px;">
                  <mat-label>End Date</mat-label>
                  <input [disabled]='true' matInput placeholder="End Date" name="enddate" [value]="requestdate"
                    autocomplete="off" required>
                </mat-form-field>
              </td>
    
            </tr>
            <h3 style="color:rgb(0, 0, 0);font-size: 18px;font-weight: 500px;margin-top: 2%;">
              Employee Details
            </h3>
            <tr>
              <td>
                <mat-form-field style="width: 175px;">
                  <mat-label>Employee Code</mat-label>
                  <input matInput placeholder="Employee Code" name="code" [value]="employee_code" [disabled]="true"
                    autocomplete="off" required>
                </mat-form-field>
              </td>
              <td>
                <mat-form-field style="width: 175px;padding-left: 50px;">
                  <mat-label>Employee Name</mat-label>
                  <input matInput placeholder="Employee Name" name="Name" [value]="employee_name" [disabled]="true"
                    autocomplete="off" required>
                </mat-form-field>
              </td>
              <td>
                <mat-form-field style="width: 175px;padding-left: 50px;">
                  <mat-label>Designation</mat-label>
                  <input matInput placeholder="Designation" name="designation" [value]="empdesignation" [disabled]="true"
                    autocomplete="off" required>
                </mat-form-field>
              </td>
              <td>
                <mat-form-field style="width: 175px;margin-left: 50px;">
                  <mat-label>Employee Grade</mat-label>
                  <input disabled matInput placeholder="Employee Grade" name="empgrade" [value]="empgrade"
                    autocomplete="off" required>
                </mat-form-field>
              </td>
              <td>
                <button type="button" class="btn btn-success btn-sm" data-toggle="modal" data-target="#ccbsModal"
                  style="border-radius:40px; margin-left: 50px;">
                  CCBS</button>
                  <button type="button" class="btn btn-info btn-sm" data-toggle="modal" data-target="#approval"
                  style="border-radius:40px; margin-left: 20px;">
                  Approval Flow</button>
              </td>
    
            </tr>
    
    
    
          </table>
          <div class="table-responsive" style="width:100%;margin-top: 1%; overflow-x: hidden;">
            <table class="table table-bordered" fixed-header style="width: 99%;margin-top: 10px;">
              <thead class="table_header" style="text-align: left;">
                <tr>
                  <th>S.No</th>
                  <th>Expense Type</th>
                  <th>Original Invoice</th>
                  <th>Eligible Amount</th>
                  <th>Claim Amount</th>
                  <th *ngIf="applevel==2">Approved Amount</th>
                  <th>Request Comments</th>
                  <th>Expense Details</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let getclaim of getclaimrequest;index as i">
                  <td>{{i+1}}</td>
                 
                  <td>
                    <div *ngIf="getclaim.expenseid == 1">Travelling Expense</div>
                    <div *ngIf="getclaim.expenseid == 2">Daily Diem</div>
                    <div *ngIf="getclaim.expenseid == 3">Incidental Expenses</div>
                    <div *ngIf="getclaim.expenseid == 4">Local Conveyance</div>
                    <div *ngIf="getclaim.expenseid == 5">Lodging</div>
                    <div *ngIf="getclaim.expenseid == 6">Miscellaneous Charges</div>
                    <div *ngIf="getclaim.expenseid == 7">Packaging Freight</div>
                    <div *ngIf="getclaim.expenseid == 8">Local Deputation</div>
                  </td>
                  <td style="text-align: center;"><b>{{getclaim.type==1?"Yes":"No"}}</b></td>
                  <td>{{getclaim.eligibleamount | currency:"INR"}}</td>
                  <td>{{getclaim.claimedamount | currency:"INR"}}</td>
                  <td *ngIf="applevel ==2">{{getclaim.approvedamount | currency:"INR"}}</td>
                  <td>{{getclaim.requestercomment}}</td>
    
                  <td><button mat-icon-button matTooltip=" Edit" class="iconbutton" color="primary"
                      (click)="expenseEdit(getclaim)">
    
                      <mat-icon style="color:green;" aria-label="Edit">edit</mat-icon>
                    </button>
    
    
                  </td>
              </tbody>
              <tr>
    
                <th class="totaldisplay" colspan="2"></th>
                <td>Total Eligible Amount:{{eligibleamt | currency:"INR"}}</td>
                <td>Total Claim Amount:{{claimedamt | currency:"INR"}}</td>
                <td>
                  Total Approved Amount :{{approvedamt | currency:"INR"}}
                </td>
                <td>
                  <button type="button" class="btn btn-info btn-sm" (click)="getimages()" *ngIf="showeditfile"
                    style="border-radius: 40px;margin-left: 10px;" data-toggle="modal" data-target="#showattachmentpopup">
                    Attachment</button>
                </td>
                <th class="totaldisplay" colspan="5"></th>
              </tr>
            </table>
            <br><br>
            <div class="row" style="gap:10px;margin-left:15px">
              <h2 style="font-weight:bold;">Credit Details </h2>
              <button class="btn btn-outline-success" matTooltip="Credit Details" style="border-radius:20px;height:fit-content" [disabled]="disablecretditdetails==2" (click)="addcreditSection()"><span class="fa fa-plus">Credit Details</span></button>
            </div>
  
            <div class="table-responsive" style="width:100%;margin-top: 1%;">
              <form [formGroup]="expenceformview">
                <table class="table table-bordered" fixed-header style="width: 99%;margin-top: 10px;">
                    <thead class="table_header" style="text-align: center;">
                        <tr>
                                <th>S.No</th>
                                <th>Paymode<span style="color:red">*</span></th>
                                <th>Account Detail/GL<span style="color:red">*</span></th>
                                <th>Ref No</th>
                                <th>Bank Name</th>
                                <th>Branch Name</th>
                                <th>IFSC Code</th>
                                <th>Beneficiary Name</th>
                                <th>GL No</th>
                                <th>Amount<span style="color:red">*</span></th>
                                <th>Amount change</th>
                                <th>Action</th>
                                
                            </tr>
                        </thead>
                        <tbody>
                            <ng-container formArrayName="creditdtl"
                            *ngFor="let section of getCreditSections(expenceformview); let creditindex = index">
                            <tr [formGroupName]="creditindex">
                                <td>{{creditindex+1}}</td>
                                <td>
                                    <mat-form-field  style="width:100px" (click)="getPaymode_drpdwn()" >
                                    <mat-label>Paymode</mat-label>
                                    <input  [matAutocomplete]="paymode" placeholder="Paymode" matInput formControlName="paymode_id" [readonly]="creditindex === 0 || crd_details_amntsaved" >
                                      <mat-autocomplete [panelWidth]="200" #paymode="matAutocomplete" [displayWith]="displayPaymode">
                                        <!-- <mat-option  *ngIf="isLoading" class="is-loading">Loading...</mat-option> -->
                                        <ng-container >
                                            <mat-option  *ngFor="let paymode of paymodedropdown" (click)="getcreditgl(creditindex)"
                                             [value]="paymode">{{paymode.name}}
                                            </mat-option>
                                        </ng-container>
                                    </mat-autocomplete>
                                </mat-form-field>
                                
                                </td>
                                <td >
                                    <div>
                                    <mat-form-field>
                                        <mat-label>Acc no</mat-label>
                                        <input matInput placeholder="Account No" formControlName="accno"
                                        autocomplete="off" readonly>
                                      
                                    </mat-form-field>
                                    </div>
                                   
                                </td>                             
      
        
                                <td>
                                    <mat-form-field style="width:150px">
        
                                        <input matInput placeholder="Ref No" formControlName="refno"
                                            autocomplete="off" readonly>
                                    </mat-form-field>
                                </td>
        
        
        
                                <td>
                                    <mat-form-field>
        
                                        <input matInput placeholder="Bank Name" formControlName="bank"
                                            autocomplete="off" readonly>
                                    </mat-form-field>
        
                                </td>
        
                                <td>
                                    <mat-form-field style="width:130px">
        
                                        <input matInput placeholder="Branch Name" formControlName="branch"
                                            autocomplete="off" readonly>
                                    </mat-form-field>
                                </td>
        
                                <td>
                                    <mat-form-field style="width:120px">
        
                                        <input matInput placeholder="IFSC code" formControlName="ifsccode"
                                            autocomplete="off" readonly>
                                    </mat-form-field>
                                </td>
        
        
                                <td>
                                    <mat-form-field style="width:180px">
        
                                        <input matInput placeholder="Beneficiary" formControlName="benificiary"
                                            autocomplete="off" readonly>
                                    </mat-form-field>
                                </td>
                               
                                <td>
                                    <mat-form-field
                                        style="width: 150px;">
        
                                        <!-- <input matInput placeholder="Credit GL" formControlName="glno"
                                            autocomplete="off" readonly> -->
                                            <input  [matAutocomplete]="glno" placeholder="Credit GL" matInput formControlName="glno" [readonly]="creditindex === 0 || crd_details_amntsaved" >
                                            <mat-autocomplete [panelWidth]="200" #glno="matAutocomplete" [displayWith]="displayFngl">
                                              <!-- <mat-option  *ngIf="isLoading" class="is-loading">Loading...</mat-option> -->
                                              <ng-container >
                                                  <mat-option  *ngFor="let gl of creditgllist"
                                                   [value]="gl">{{gl.glno}}
                                                  </mat-option>
                                              </ng-container>
                                          </mat-autocomplete>   
                                            
                                    </mat-form-field>
                                   
                                   
                                </td>
                                <td>
                                    <mat-form-field
                                        style="width: 100px;">
        
                                        <input matInput placeholder="Amount"   formControlName="amount" readonly style="text-align: right;">
                                    </mat-form-field>
                                </td>
                               
                                <td>
                                  <mat-form-field style="width:100px">
                                    <input matInput placeholder="Amount change" pattern="^(?:100|[1-9][0-9]?|[1-9])$"  formControlName="amountmatched" style="text-align:right" (keyup)="amountchange(creditindex)" [readonly]="creditindex === 0 || crd_details_amntsaved ">
                                  </mat-form-field>
                                </td>
                                <td>
                                  <button type="button" mat-icon-button aria-label="delete"[disabled]="creditindex === 0 ||crd_details_amntsaved" (click)="removecreditd(creditindex)">
                                  <mat-icon style="color:red" >
                                    delete
                                  </mat-icon>
                                </button>
                                </td>
                                
        
        
                            </tr>
                           </ng-container>
                        </tbody>
        
                            <tr>
                                <td class="totaldisplay" colspan="11"
                                    style="text-align: right">
                                    Net Amount:</td>
                                <td style="text-align: end;">{{cdtsum | currency:'INR'}}</td>
                            </tr>
                            <tr>
                                <td colspan="11" *ngIf="disablecretditdetails==2 ">
                                    <button type="button" style="border-radius:40px;;margin-left: 2375px;" [disabled]="crd_details_amntsaved"
                                        class="btn btn-outline-primary" (click)="submitcredit()">
                                            Save</button>
                                </td>
                            </tr>
             </table>
            </form>
            </div>
            
      
      <br><br>
  
          </div>
          <!-- <div class="modal fade bd-example-modal-lg" data-backdrop="static" data-keyboard="false" id="showcreditglpopup" tabindex="-1"
            role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content">
                <div class="modal-header" style="background-color: #DDEFDD;">
                  <h2 class="modal-title" id="exampleModalLongTitle">Credit GL</h2>
                  <button type="button" class="close" #closebutton data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <form [formGroup]="creditglform">
                    <div class="row mb-md-3 mb-lg-3" style="margin-left: -5px;">
                      <div class="col-md-4">
                        <mat-form-field style="width: 250px">
                          <mat-label>Paymode</mat-label>
                        </mat-form-field>
                      </div>
          
          
                      <div class="col-md-4">
                        <mat-form-field style="width: 250px;">
                          <mat-label>Credit Gl</mat-label>
                          <input placeholder="Credit Gl" matInput formControlName="creditgl" [matAutocomplete]="auto">
                          <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFngl">
                                                  <mat-option  class="is-loading">Loading...</mat-option>
                                                  <ng-container >
                                                      <mat-option *ngFor="let gl of creditgllist" [value]="gl">{{gl.glno}}
                                                      </mat-option>
                                                  </ng-container>
                                              </mat-autocomplete>
                        </mat-form-field>
                      </div>
                  
                    </div>
                    <div class="row justify-content-center" style="gap:10px">
                      <button type="submit" class="btn btn-success" style="border-radius:20px" (click)="submitglnumber()">Submit</button>
                      <button type="button" class="close" #closebutton data-dismiss="modal" aria-label="Close"  class="btn btn-danger" style="border-radius:20px">Cancel</button>

                    </div>
                  </form>
                </div>
              </div>
             </div>
            </div> -->
          <td>
    
            <div class="modal fade" tabindex="-1"  data-backdrop="static" role="dialog" aria-labelledby="exampleModalLabels"
              aria-hidden="true" id="ccbsModal">
              <div class="modal-dialog modal-xl" style="width: 85%;">
                <div class="modal-content">
                  <div  class="modal-header" style="background:#DDEFDD">
                    <h2 class="modal-title" style="width: 250px;margin-left: 20px;">CCBS (Tour No) : {{this.id}} </h2>
                    <div style="margin-left:39%">
                      <h2 class="modal-title" style="width: 250px;margin-left: 50px;">Approve Amount :
                        {{approvedamt}}</h2>
                    </div>
                    <button type="button" #closebutton class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
    
                  <div   style="margin-left: 40px;margin-right: 40px;margin-top: 4%; width: 100%; margin-bottom: 2%;">
                   <!-- <div>
                    <button class="modal-title" type="button"  
                                  class="btn btn-outline-success" 
                                  
                                  (click)="addccbs()" style="border-radius:40px;margin-left:10%"><span
                                    class="fa fa-plus"></span>
                                </button>
                                </div> -->

                    <!-- <fieldset [disabled]="true">
                      <table>
    
                        <tr *ngFor="let dt2 of ccbslist;let ind=index;">
                          <td>
                            <mat-label>BS</mat-label> <br>
                            <mat-form-field floatLabel="never" style="width: 250px;">
                              
                              <input type="text" #bsid placeholder="Select BS" matInput [value]="dt2.bs_data.name">
                            </mat-form-field>
                          </td>
                          <td>
                            <mat-label style="margin-left:20px">CC</mat-label> <br>
                            <mat-form-field floatLabel="never" style="width: 250px;margin-left: 20px;">
                              
                              <input type="text" placeholder="Select CC" matInput [value]="dt2.cc_data.name">
                            </mat-form-field>
                          </td>
    
                          <td>
                            <mat-label style="margin-left:20px">Amount</mat-label><br>
                            <mat-form-field floatLabel="never" style="width: 175px;margin-left: 20px;">
                              
                              <input matInput placeholder="Amount" [value]="dt2.amount" autocomplete="off" required>
                           
                            </mat-form-field>
                          </td>
                          <td>
                            <mat-label style="margin-left:20px">Percentage</mat-label><br>
                            <mat-form-field floatLabel="never" style="width: 175px;margin-left: 20px;">
                              
                              <input matInput placeholder="Percentage" maxlength="3" [value]="dt2.percentage"
                                autocomplete="off" required>
                           
                            </mat-form-field>
                          </td>
    
                        </tr>
                      </table>
                    </fieldset>
                      <div class="col-md-11 text-center" style="margin-bottom: 4%;">
    
                        <button type="button" data-dismiss="modal" class="btn btn-outline-secondary"
                          style="border-radius: 40px;margin-left: 20px;">Close</button>
    
                      </div> -->
                      <div formArrayName='ccbs' style="margin-top: 4%; margin-bottom: 2%;" >
                        <div class="col-md-1" style="margin-top: -5%;margin-left: 84%; ">
                          <button type="button" class="btn btn-outline-success" matTooltip="Addccbs"
                            (click)="addccbs()"
                            style="border-radius:40px;"><span class="fa fa-plus"></span>
                          </button>
                       </div>
                    
                      <fieldset>
                        <table>
                          
                          <tr *ngFor="let dt2 of expenceform.controls.ccbs['controls'] ;let ind=index;"
                          [formGroupName]="ind">
                            <td>
                               
                              <mat-form-field style="width: 250px;margin-left: 20px;">
                                <mat-label>BS</mat-label>
                                <input required  id="ccbssearch" type="text" #bsid
                                  placeholder="Select BS" matInput [matAutocomplete]="bsss" (keypress)="checkind(ind)"
                                  formControlName="bsid">
                                <mat-autocomplete #bssid #bsss="matAutocomplete" (opened)="bsidget()"
                                  [displayWith]="bsview">
                                  <mat-option *ngFor="let bsid of bisinesslist" (click)="getBS(bsid.id,ind)"
                                    [value]="bsid">
                                    {{bsid.code}}-{{bsid.name}}
                                  </mat-option>
                                </mat-autocomplete>
                              </mat-form-field>
                            </td>
                            <td>

                              <mat-form-field style="width: 250px;margin-left: 20px;">
                                <mat-label>CC</mat-label>
                                <input required  type="text" placeholder="Select CC"
                                  matInput (keypress)="checkccind(ind)" [matAutocomplete]="csss"
                                  formControlName="ccid">
                                <mat-autocomplete #csss="matAutocomplete" [displayWith]="csview">
                                  <mat-option *ngFor="let ccid of costlist" [value]="ccid">
                                    {{ccid.code}}-{{ccid.name}}
                                  </mat-option>
                                </mat-autocomplete>
                              </mat-form-field>
                            </td>

                            <td>
                              <mat-form-field style="width: 175px;margin-left: 20px;">
                                <mat-label>Claim Amount</mat-label>
                                <input matInput placeholder="Amount" (input)="ccbs_validation(ind,'amount')"
                                   formControlName="amount"
                                  (blur)="percen_calc($event,ind)" appNumberOnly autocomplete="off" required>
                               <!-- {{this.value1}} -->
                              </mat-form-field>
                            </td>
                            <td>
                              <mat-form-field style="width: 175px;margin-left: 20px;">
                                <mat-label>Percentage</mat-label>
                                <input matInput placeholder="Percentage"  maxlength="4" (input)="ccbs_validation(ind)"
                                  (blur)="amount_calc($event,ind)" appNumberOnly formControlName="percentage" 
                                  pattern="^(?:100|[1-9][0-9]?|[1-9])$" required>
                                <!-- {{this.value}} -->
                              </mat-form-field>
                            </td>
                            <td>
                              <div style="width: 175px;margin-left: 35px;">
                                <button  class="btn btn-outline-danger" matTooltip="Delete"
                                 
                                  (click)="removeSection1(ind,dt2)" style="border-radius:40px;"><span
                                    class="fa fa-trash"></span>
                                </button>
                              </div>
                            </td>
                          </tr>
                        </table>
                      </fieldset>
                      <div class="col-md-11 text-center" style="margin-bottom: 4%;">

                        <button type="submit" style="border-radius: 40px;margin-left: 10px;" (click)="submitccbs()"
                            class="btn btn-success">Submit</button>

                        <button type="button" data-dismiss="modal" class="btn btn-danger"
                          style="border-radius: 40px;margin-left: 20px;">Close</button>

                      </div>
                      </div>

                  </div>
    
                </div>
    
              </div>
            </div>
          </td>
          <div>
            <table align="center" style="margin-top: 3%;" *ngIf="applevel==2">
              <tr>
              
                <div style="border: 1px solid black;">
                  <div style="margin: 10px 10px 10px 10px;">
                    <td>
                      Total Claimed Amount : {{claimedamt | currency:"INR"}}
                    </td>
                    <td style="padding-left: 50px;">
                      Advance to be Adjusted : {{sumadvance | currency:"INR"}}
    
                    </td>
    
                    <br>
    
              <tr>
                <td>
    
                </td>
                <td>
                  Total Approved Amount : {{approvedamt | currency:"INR"}}
                </td>
                <td style="padding-left: 50px; padding-top: 4px;">
                  <h3 style="color:blue;"> Net Payable : {{netpay | currency:"INR"}}</h3>
                </td>
              </tr>
          </div>
        </div>
        </table>
    </div>
    
    
    <div *ngIf="(applevel == 1 || applevel == 2) && changeapprover == false ">
      <mat-form-field style="width: 270px;">
        <mat-label>Action</mat-label>
        <mat-select formControlName='action' [disabled]="invalidpermission">
          <mat-option *ngFor="let expencetypee of action" (click)="actionchange()" [value]="expencetypee">
            {{expencetypee}}
          </mat-option>
        </mat-select>
      </mat-form-field>
    
    </div>
    <div *ngIf="actionapprove && !invalidpermission">
    
      <h3 style="color:rgb(0, 0, 0);font-size: 18px;font-weight: 500px;margin-top: 2%;">
        To Approve
      </h3>
      <fieldset [disabled]="invalidpermission" style="margin-top:-1%">
        <mat-form-field class="tabranch">
          <mat-label>Branch</mat-label>
          <input type="search" #inputassetid placeholder="Select Branch" matInput [matAutocomplete]="conoffice"
            [attr.disabled]="empbrid == true ? true : null" formControlName="empbranchid"><button mat-button matSuffix
            (click)="brclear()" mat-icon-button aria-label="Clear">
            <mat-icon>close</mat-icon>
          </button>
      
          <mat-autocomplete #assetid #conoffice="matAutocomplete" (opened)="autocompleteid()">
            <mat-option *ngFor="let branch of branchlist" (click)="selectBranch(branch.id)"
              [value]="'('+(branch.code)+') '+(branch.name)">
              ({{branch.code}}) {{branch.name}}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>
    
        <mat-form-field class="taemployee">
          <mat-label>Employee</mat-label>
          <input type="search" placeholder="Select Employee" matInput [matAutocomplete]="empc"
            [attr.disabled]="apvl == true ? true : null" formControlName="approval">
          <button mat-button matSuffix (click)="empclear()" mat-icon-button aria-label="Clear">
            <mat-icon>close</mat-icon>
          </button>
          <mat-autocomplete #empc="matAutocomplete" [displayWith]="displayFn">
            <mat-option *ngFor="let emp of employeelist" [value]="emp">
              ({{emp.code}}) {{emp.full_name}}-{{emp.employee_designation}}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>
    
    
    
    
        <mat-form-field class="tatextarea">
          <mat-label>Remarks</mat-label>
          <textarea cdkTextareaAutosize #autosize="cdkTextareaAutosize" cdkAutosizeMinRows="1" cdkAutosizeMaxRows="5"
            matInput placeholder="Remarks" (keypress)="omit_special_char($event)" (change)="remarksupdate($event)"
            formControlName="appcomment" autocomplete="off" required></textarea>
        </mat-form-field>
    
      </fieldset>
        <button [disabled]="submitvaluecheck()" type="submit"
          style="border-radius: 40px;margin-left: 40%;" class="btn btn-success"
          (click)="approvefirst()">Submit</button>
    
          <button type="button" (click)="back()" class="btn btn-success"
        style="border-radius: 40px;margin-left: 20px;">Back</button>
      
    </div>
    <div>
      <div class="modal fade" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true"
        id="showattachmentpopup">
        <div class="modal-dialog modal-xl " style="width: 70%;">
          <div class="modal-content">
            <div class="modal-header" style="background:rgba(23, 204, 23, 0.288);">
              <h2 class="modal-title" style="color:black ;text-align: center;">Tour Attachment View</h2>
              <button type="button"  data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
    
            <div *ngIf="attachmentlist.length > 0" style="margin-left: 50px;margin-right: 80%;margin-top: 2%; width: 80%;">
              <div class="container">
                <div class="row">
                  <div class="table-responsive">
                    <table class="table table-bordered" fixed-header
                      style="width: 95%;margin-top: 10px;margin-left:30px;overflow-x: hidden;">
                      <thead class="table_header" style="text-align: left;">
                        <tr>
                          <th style="text-align: center;">S.No</th>
                          <th style="text-align: center;">File Name</th>
                          <th style="text-align: center;">View</th>
                          <th style="text-align: center;">Download</th>
    
    
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let attach of attachmentlist; index as i">
                          <td style="text-align: center;">{{i+1}}</td>
                          <td style="text-align: center;">{{attach.file_name}}</td>
                          <td style="text-align: center;color:blue;">
                            <div matTooltip="View" class="fa fa-arrow-up" aria-hidden="true" data-target="#exampleModal1"
                              data-toggle="modal" (click)="commentPopup(attach.id,attach.file_name )">
    
                          
                          
                            </div>
                          </td>
                       
                          <td style="text-align: center;">
                            <button class="btn btn-outline-primary" type="submit"
                              style="border-radius:40px;margin-left: 15px;" color="primary"
                              (click)="getimagedownload(attach.url,attach.file_name)">
                              <i matTooltip="Download" class="fa fa-download" aria-hidden="true"></i>
                            </button>
                          </td>
                        </tr>
                      </tbody>
                    </table>
    
                  </div>
                </div>
              </div>
    
    
            </div>
          </div>
        </div>
      </div>
    </div>
    
    
    
    <br>
    <!-- <div *ngIf="show_approvebtn" class="col-md-12 text-center" style="margin-bottom:2%;margin-top: -1%;">
    
      <mat-form-field style="width: 300px;" *ngIf="(actionreject || actionreturn || amtapprove) && !actionapprove">
        <input matInput type="text" placeholder="Reason" [disabled]="invalidpermission" [value]='reasonchange'
          (keypress)="omit_special_char($event)" (change)="reasonupdate($event)" required>
      </mat-form-field>
    
      <button type="submit" *ngIf="applevel==2 && amtapprove" matTooltip="Approve"
        style="border-radius: 40px;margin-left: 30px;" class="btn btn-outline-success"
        (click)="approveclaim()">Approve</button>
    
      <button type="submit"
        *ngIf="actionreject"
        [disabled]="reapprove" MatTooltip="Reject" style="border-radius: 40px;margin-left: 30px;" class="btn btn-outline-danger"
        (click)="rejectclaim()">Reject</button>
    
      <button type="submit" matTooltip="Return"
        *ngIf="actionreturn"
        [disabled]="reapprove" style="border-radius: 40px;margin-left: 30px;" class="btn btn-outline-secondary"
        (click)="returnclaim()">Return</button>
        <button type="button" matTooltip="Submit" (click)="submitForm()" class="btn btn-success"
        style="border-radius: 40px;margin-left: 20px;">Submit</button>

    <button type="button" matTooltip="Return"  class="btn btn-outline-secondary"
      (click)="returnclaim()" style="border-radius: 40px;margin-left: 20px;">Return</button>
      <button type="button" matTooltip="Back" *ngIf="!actionapprove" (click)="back()" class="btn btn-primary"
        style="border-radius: 40px;margin-left: 20px;">Back</button>
    
    
    </div> -->
<mat-form-field style="width: 300px;" >
      <input matInput type="text" placeholder="Reason"[value]='reasonchange' 
        (keypress)="omit_special_char($event)" (change)="reasonupdate($event)" required>
    </mat-form-field>
    <div class="text-center row">
      <button type="button"  class="btn btn-info btn-sm"
      (click)="returnExpenceCheckerclaim()" style="border-radius: 40px;margin-left: 20px;">Return Expense Approver</button>
      <button type="button"  class="btn btn-info btn-sm"
      (click)="returnTourMaker()" style="border-radius: 40px;margin-left: 20px;">Return To Initiator</button>
      <button type="button"  class="btn btn-danger btn-sm"
       style="border-radius: 40px;margin-left: 20px;" (click)="rejectclaim()">Reject</button>
       <button type="button" class="btn btn-success btn-sm" *ngIf="isapprovepay_btnenable"
                (click)="approve_pay()" data-dismiss="modal" style="border-radius: 40px; margin-left: 20px;">Approve and Pay</button>
                <button type="button" (click)="back()" class="btn btn-primary btn-sm"
                style="border-radius: 40px;margin-left: 20px;">Back</button>
     </div>
     <br>

    
    
    <!-- <div *ngIf="advance_statusid != -1" class="table-responsive" style="width:70%;margin-top: 1%; overflow-x: hidden;">
      <h2 style="color:rgb(0, 0, 0);font-size: 18px;font-weight: 500px;">Advance Adjust</h2>
      <table class="table table-bordered" fixed-header>
        <thead class="table_header" style="text-align: left;">
          <tr>
            <th>S.No</th>
            <th>CRN No</th>
            <th>Date</th>
            <th>Amount</th>
            <th>Balance</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let advance of advancelist|paginate: { id:'advpagination',itemsPerPage: pageadsize, currentPage: presentpage }; index as i">
    
            <td>
    
            </td>
            <td>
    
            </td>
            <td>
    
            </td>
            <td>
    
            </td>
            <td>
    
            </td>
          </tr>
          <tr>
            <th colspan="7">
              <div class="pagination" style="text-align: center;">
                <pagination-controls responsive="true" id="advpagination" (pageChange)="presentpage = $event">
                </pagination-controls>
              </div>
            </th>
          </tr>
        </tbody>
      </table>
    </div> -->
    <div class="modal fade" tabindex="-1"  data-backdrop="static" role="dialog" aria-labelledby="exampleModalLabels"
    aria-hidden="true" id="approval">
    <div class="modal-dialog modal-xl " style="width: 80%;">
      <div class="modal-content">
        <div class="modal-header"  style="background: rgba(69, 239, 69, 0.288);">
          <h2 class="modal-title" style="color:black ;text-align: center;font-weight: bold;">Approval Flow</h2>
          <button type="button" class="close" data-dismiss="modal" #closefile aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
    <div class="table-responsive" style="width:100%;margin-top: 1%; margin-bottom: 2%; margin-left: 100px; overflow-x: hidden;">
      <table class="table table-bordered" fixed-header style="width: 80%;margin-top: 10px;">
        <thead class="table_header" style="text-align: left;">
          <tr>
            <th>S.No</th>
            <th>Date</th>
            <th>Type </th>
            <th>Employee</th>
            <th>Raised By</th>
    
            <th>Remarks</th>
            <th>Status</th>
    
          </tr>
        </thead>
    
        <tbody>
        <tbody>
          <tr
            *ngFor="let advanceapprove of getAdvanceapproveList|paginate: { itemsPerPage: pageSize, currentPage: p }; index as i">
            <td scope="row" style="vertical-align: middle;"> {{((p-1)*pageSize)+i+1}}</td>
            <td>{{advanceapprove.approveddate| date:'dd-MMM-yyyy'}}</td>
            <td>{{advanceapprove.apptype}}</td>
            <td>({{advanceapprove.approver_code}}) {{advanceapprove.approvedby}}</td>
            <td>({{advanceapprove.onbehalfof.code}}) {{advanceapprove.onbehalfof.full_name}}</td>
    
            <td style="overflow-wrap:anywhere">{{advanceapprove.comment}}</td>
            <td>
              <p *ngIf="advanceapprove.status == 1">
                REQUESTED</p>
              <p *ngIf="advanceapprove.status == 2">
                PENDING</p>
              <p *ngIf="advanceapprove.status == 3">
                APPROVED</p>
              <p *ngIf="advanceapprove.status == 4">
                REJECTED</p>
              <p *ngIf="advanceapprove.status == 5">
                RETURNED</p>
              <p *ngIf="advanceapprove.status == 6"> Tour Advance Submitted</p>
              <p *ngIf="advanceapprove.status == 17">
                Tour Advance Cancel Submitted</p>
    
    
            </td>
        </tbody>
        <tr>
          <th colspan="7">
            <div class="pagination">
              <pagination-controls responsive="true" (pageChange)="p = $event"></pagination-controls>
            </div>
          </th>
        </tr>
      </table>
    </div>
    </div>
    </div>
    </div>   
    </div>
    <div class="modal fade" id="exampleModal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content" style="width:fit-content">
      <div class="modal-header">

        <h3 class="modal-title w-100" id="exampleModalLabel">
          <strong> Attachment View</strong>
        </h3>

        <!-- <h4> To delete the current file click here</h4> -->
        <!-- <button mat-icon-button type="button">
          <mat-icon style="color: gray;" aria-label="Edit" (click)="fileDelete()">
            delete</mat-icon>
        </button> -->
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="closefile_window()">
          <span aria-hidden="true">
            
          </span>
        </button>
      </div>


      <div class="modal-body" style="width:700px">
        <div *ngIf='this.fileextension =="pdf"'>
          <pdf-viewer [src]="jpgUrls" [original-size]="false" [render-text]='false'
          [show-borders]="true" [fit-to-page]="true" [show-all]="true"
          style="display: block; height: 400px;" [fit-to-page]="true">
        </pdf-viewer>
        </div>
        <div *ngIf='this.fileextension !="pdf"'>
          <img src="{{jpgUrls}}" class="img-responsive" style="width: 100%;">
        </div>
        <div *ngIf='this.filesystem_error'>
          <p>This File is Already Downloaded. Please check downloads.</p>
        </div>



      </div>

      <div class="modal-footer">

      </div>
    </div>
  </div>
</div> 
    

    </form>
    </div> 
    </div>
<div id ="tamain" *ngIf="createsummary">

  <form [formGroup]="commonapForm">
    
    <p style="color:black;font-size:18px;font-family:'Times New Roman';font-weight:bold;margin-left: 3%;">
      Settlement Approval
    </p>
    
     <table>
    <tr>
      <td style="margin-left: 3%;">
        <mat-form-field class="example-full-width" style="margin-left: 33px;">
            <input class="toolbar-search" type="text" matInput autocomplete="off" formControlName="tour_id">
            <mat-placeholder>Tour ID</mat-placeholder>
        </mat-form-field>
      
    </td>
          <td style="margin-left: 3%;">
            <mat-form-field class="example-full-width" style="margin-left: 33px;">
                <input class="toolbar-search" type="text" matInput autocomplete="off" formControlName="crno">
                <mat-placeholder>CR NO</mat-placeholder>
            </mat-form-field>
          
        </td>
        <!-- <td style="margin-left:50px;">
          <mat-form-field class="example-full-width" style="margin-left: 33px;">
              <input class="toolbar-search" type="text" matInput autocomplete="off" formControlName="tour_id">
              <mat-placeholder>Tour ID</mat-placeholder>
          </mat-form-field>
        
      </td> -->

       <td>
           
            <mat-form-field class="example-full-width" style="margin-left: 50px;">
                <mat-label>ECF Type</mat-label>
                <mat-select  formControlName="aptype" >
                    <mat-option *ngFor="let type of Ecf_type" [value]="type['id']" matTooltip="{{type['text']}}">
                        {{type['text']}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </td>

        <td>
           
            <mat-form-field class="example-full-width" style="margin-left: 50px;">
                <mat-label>ECF Status</mat-label>
                <mat-select  formControlName="apstatus">
                    <mat-option *ngFor="let status of StatusList" [value]="status.id" matTooltip="{{status.text}}">
                        {{status.text}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
        </td>
        
        <td>
           <button class="btn btn-outline-primary" type="submit"
            style="border-radius:40px;margin-left: 50px;" color="primary"
            (click)="commonSummarySearch()"><i matTooltip="Search" class="fa fa-search"
                aria-hidden="true"></i></button>
        </td>
         <td style="padding-left: 60px;">
          <button class="btn btn-outline-primary" type="button"
            style="border-radius:40px;"
           color="primary" (click)="Resetecfinventory()">Reset</button>
        </td> 
       
    </tr> 
 
    
    </table>


</form>
<br><br>
<!-- <p style="color:black;font-size:18px;font-family:'Times New Roman';font-weight:bold;margin-left: 3%;">
Common Ap Payment Summary 
</p> -->
<div class="table-responsive " style="width: 105%">
<table class="table table-bordered " fixed-header  style="width: 99%;margin-top: 10px;">	
   
    
    <thead style="text-align: center;">
        

        <tr  class="table_header " fixed-header>


            <th style="width: 50px;">S.No</th>
            <th>Tour ID</th>
            <th>CR NO</th>
            <th>ECF Raiser</th>
            <th>ECF Type</th>
            <th>ECF Amount</th>
            <th style="width: 200px;">ECF Status</th>
            <th>AP Status</th>
            <th>Commodity Name</th>
            <!-- <th>ECF Date</th> -->
            <th>View Details</th>
            <th>Invoice Date</th>
            <th>Document Required</th>
            <th>Inward Date</th>
            <th>Payment Action</th>
            <!-- <th style="width: 200px;" colspan="5">Action</th> -->
        </tr>
    </thead>

    <tbody>
        <tr *ngFor="let list of commonSummary; index as i" style="text-align: center;">
            <td style="width: 50px;"> {{(ecfpresentpage - 1)*pagesizeecf +i+1 }} </td>
            <td style="text-align: right;">{{list?.tour_no}}</td>
            <td *ngIf="list?.crno!=null">{{list?.crno}}</td>
            <td *ngIf="list?.crno === null">-</td>
            <td>{{list?.raisername}}</td>
            <td *ngIf="list?.aptype == 11" style="white-space: nowrap;">TAF</td>
            <td *ngIf="list?.aptype == 8" style="white-space: nowrap;">TCF</td>
            <td style="text-align: right;">{{list?.apamount|currency:'INR'}}</td>
            <td style="width: 200px;">{{list?.ecfstatus}}</td>
            <!-- <td *ngIf="list?.apstatus!=null">{{list?.apstatus}}</td> -->
            <td *ngIf="list?.AP_Status == 0 || list?.AP_Status == 2"  style="white-space: nowrap;">Payment Not Created</td>
            <td *ngIf="list?.AP_Status == 3 || list?.AP_Status == 4 || list?.AP_Status==5" style="white-space: nowrap;">Payment Completed</td>
            <td>{{list?.commodity_id?.name}}</td>
            <td><button mat-icon-button matTooltip="View" class="iconbutton" color="primary"
              (click)="approveexpenceEdit(list)">
              
              <mat-icon style="color: green;"class="material-icons">
                  visibility</mat-icon>
          </button>
          </td>
          <td style="white-space: nowrap;">{{ (list?.apdate !== "None") ? (list?.apdate | date:'dd-MM-yyyy') : "-" }}</td>
          <td style="width: 200px;">{{list?.papertype==1?"Yes":"No"}}</td>
            
          <td>
            <!-- <td *ngIf="enb_all_exbdetails"> -->
            <fieldset [disabled]='list?.papertype==0'>
            <mat-form-field style="width: 140px;">
              <mat-label>Inward Date</mat-label>
              <input matInput [matDatepicker]="picker" [value]="list?.apdate" (dateChange)="handleDateChange($event, i)">
              
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </mat-form-field>
          </fieldset>
          <button type="button" *ngIf="list?.papertype==1"  (click)="updateDate(i)" class="btn btn-outline-success"
        style="border-radius: 40px;">Save</button>
            </td>
            
            <td> <button type="button" class="btn btn-outline-success" matTooltip="Add"  (click)="approve_screen(list)"
                style="border-radius:40px;"><span
                    class="fa fa-plus" data-toggle="modal" data-target="#paymentAdd"></span></button>
            </td>
            
                    <!-- (click)="showadd()" -->
                
                <!-- <td style="width: 20px;" *ngIf="list?.ecfstatus?.text == 'DRAFT' || list?.ecfstatus?.text == 'READY FOR BATCH' || list?.ecfstatus?.text == 'RETURNED'">
                <button mat-icon-button matTooltip=" Edit" class="iconbutton" color="primary" style ="margin-top: 10px;"
                (click)="showedit(list)" >
                <mat-icon style="color: green;" aria-label="Edit">edit</mat-icon>
                </button>
                </td> -->
                <!-- <td style="width: 20px;" *ngIf="list?.ecfstatus?.text != 'DRAFT' && list?.ecfstatus?.text != 'READY FOR BATCH' && list?.ecfstatus?.text != 'RETURNED'">
                    <button mat-icon-button class="iconbutton" color="primary" style ="margin-top: 10px;"
                    >
                    <mat-icon style="color: grey;" aria-label="Edit">edit</mat-icon>
                    </button>
                    </td> -->
                <!-- <td style="width: 20px;" *ngIf="list?.ecfstatus?.text == 'ECF APPROVED'" >
                    <button type="button" class="btn btn-outline-success"
                    (click)="coverNotedownload(list.id,list.ecftype_id)"
                    style="border-radius: 40px;margin-left: 5px;;margin-top: 15px" >
                    <span class="fa fa-download" matTooltip="Download CoverNote">
                    </span>
                    </button>
                    </td> -->

           
          

        </tr>
    </tbody>
</table>

<div *ngIf="commonSummary ?.length == 0" style="margin-left: 42%;">
    <h3 >Sorry data not found!.. </h3>
</div>
</div>
<div class="row" *ngIf="iscommonsummarypage" style="width:85%">
    <!-- <div  class="col-sm-3" style="margin-bottom: 5%;font-size: small;text-align:left;right:-225px;">
        <p style="color:black;font-size: 18px;font-weight: 500;margin-left: -85%;">
            Total Count:{{getcommontotalcount}}
        </p> 
    </div> -->
    <div  class="col-sm-9" style="margin-bottom: 5%;font-size: small;text-align:right;left: 42%">
        <!-- <button mat-icon-button [disabled]="has_commonpageprevious === false" color="primary" (click)="previousClickcommon()">
            <mat-icon>arrow_back</mat-icon>
        </button> {{commonpresentpage}}
        <button mat-icon-button [disabled]="has_commonpagenext === false" color="primary" (click)="nextClickcommon()">
            <mat-icon>arrow_forward</mat-icon>
        </button> -->
        <mat-paginator
        (page)="handlecommonPageEvent($event)"
        [length]="length_commonecf"
        [pageSize]="pageSize_commonecf"
        [showFirstLastButtons]="showFirstLastButtons"
        [pageSizeOptions]="pageSizeOptions"
        [pageIndex]="pageIndex"
        [hidePageSize]="true"
        aria-label="Select page"> 
      
    </mat-paginator>
    </div>
    <div class="col-sm-3" style="margin-bottom: 0%;font-size: small;text-align: right;margin-top: 18px;left: -15%;font-weight:bold">
        Page: {{ecfpresentpage}}
    </div>
    </div>

<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true"
    id="Paymenttransactions">
    <div class="modal-dialog modal-xl " style="width: 93%;">
        <div class="modal-content">
            <div class="modal-header"  style="background: rgba(23, 204, 23, 0.288);">
                <h2 class="modal-title" style="color:black ;text-align: center;font-weight: bold;">Payment Details</h2>
                <button type="button" class="close" data-dismiss="modal" #closedbuttons aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div style="margin-left: 50px;margin-right: 80%;margin-top: 2%; width: 90%;">
                <div class="container">
                    <div class="row">
                        <div class="table-responsive" style="width:100%;margin-top: 1%;">
                            <table class="table table-bordered" fixed-header style="width: 99%;margin-top: 10px;">
                                <thead class="table_header" style="text-align: left;">


                                    <!-- <tr style="text-align:center">

                                        <th>S.No</th>
                                        <th>Status</th>
                                        <th>Date</th>
                                        <th>Remarks</th>
                                        <th>Employee Name</th>
                                        <th>Approver Name</th>
                                        <th>Approved By</th>
                                       


                                    </tr> -->
                                </thead>
                               
                            </table>
                            
                            
                            
                           
                        </div>
                       
                    </div>


                </div>
            </div>
        </div>
    </div>
</div>


<div >
    <div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true"
      id="paymentAdd">
      <div class="modal-dialog modal-xl " style="width: auto;">
        <div class="modal-content">
          <div class="modal-header"  style="background: rgba(23, 204, 23, 0.288);">
            <h2 class="modal-title" style="color:black ;text-align: center;font-weight: bold;">Add Payment Details</h2>
            <button type="button" class="close" data-dismiss="modal" #closefile aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <form class="container" [formGroup]="approvepayform">
            <div style="margin-left: 8px;margin-right: 60%;margin-top: 2%; width: auto;">
            <div class="container">
              <table class="table table-bordered " fixed-header  style="width: 99%;margin-top: 10px;">	
   
    
                <thead style="text-align: center;">
                    
            
                    <tr  class="table_header " fixed-header>
                        <th style="width: 50px;">S.No</th>
                        <th>CR NO</th>
                        <th>ECF Raiser</th>
                        <th>ECF Type</th>
                        <th>ECF Amount</th>
                        <th style="width: 200px;">ECF Status</th>
                        <th>Commodity Name</th>   
                        <th>Invoice Date</th>
                        <th>Document Required</th>
                        <th>Inward Date</th>      
                    </tr>
                </thead>
            
                <tbody>
                    <!-- <tr *ngFor="let list of commonSummary; index as i" style="text-align: center;"> -->
                        <td style="width: 50px;"> 1 </td>
                        <td>{{crnumber}}</td>
                        <td>{{ecf_raiser}}</td>
                        <td>{{ecf_type==8?'TCF':'TAF'}}</td>
                        <td>{{ecf_amount}}</td>
                        <td>{{ecf_status}}</td>
                        <td>{{commodity_name}}</td>
                        <td>{{invoice_date}}</td>
                        <td>{{with_paper==1?"Yes":"No"}}</td>
                        <td>{{apdate}}</td>
                        
                    <!-- </tr> -->
                </tbody>
              </table>
                    <!-- <table class="table table-bordered" fixed-header >
                       
                        <thead class="table_header" style="text-align: left;"> -->

                      <!-- <tr>                        
                        <th style="text-align: center;">S.No</th>
                        <th style="text-align: center;">File Name</th>
                        <th style="text-align: center;">Download File</th>
                        <th style="text-align: center;">Delete File</th>


                      </tr> -->
                    <!-- </thead>
                  
                  </table> -->
                 
                <!-- </div> 
          
              </div> -->
              <div class="center" style="display: flex;justify-content: center;align-items: center;gap:20px;margin-bottom: 20px;">
                <button type="button" class="btn btn-outline-success"
                (click)="approve_pay()" data-dismiss="modal" style="border-radius: 40px;">Approve and Pay</button>
                <button type="button" data-dismiss="modal" class="btn btn-outline-secondary"
                          style="border-radius: 40px;margin-left: 20px;">Close</button>
              </div>
            </div>


          </div>
        </form>
        </div>
      </div>
    </div>
  </div>

</div>
<div id="tamain" *ngIf="Advance">
  <h3 style="margin-left: 44px;margin-top: 30px; font-size: 22px;font-weight: 500;">
    eClaim AP User Screen({{crnumber}})
  </h3>
  <hr>
  <div  style="margin-left: 50px;margin-top: 2%; width: 100%;"> 
    <h3 style="color:rgb(0, 0, 0);font-size: 18px;font-weight: 500px;margin-top: 1%;">
      Tour Details
    </h3>
    <form [formGroup]="expenceform">
      <div>
  
        <table>
          <tr>
            <td>
              <mat-form-field style="width: 175px;">
                <mat-label>Tour No</mat-label>
                <input matInput placeholder="Tour No" name="requestno" [value]="tourgid" [disabled]="true"
                  autocomplete="off" required>
              </mat-form-field>
            </td>
            <td>
              <mat-form-field style="width:250px;padding-left: 50px;">
                <mat-label>Tour Reason</mat-label>
                <input matInput placeholder="Tour Reason" name="reason" [value]="reason" [disabled]="true"
                  autocomplete="off" required>
              </mat-form-field>
            </td>
            <td>
              <mat-form-field style="width: 175px;padding-left: 50px;">
                <mat-label>Start Date</mat-label>
                <input matInput placeholder="Start Date" name="startdate" [value]="startdate" [disabled]="true"
                  autocomplete="off" required>
              </mat-form-field>
            </td>
            <td>
              <mat-form-field style="width: 175px;margin-left: 50px;">
                <mat-label>End Date</mat-label>
                <input [disabled]='true' matInput placeholder="End Date" name="enddate" [value]="requestdate"
                  autocomplete="off" required>
              </mat-form-field>
            </td>
  
          </tr>
          <h3 style="color:rgb(0, 0, 0);font-size: 18px;font-weight: 500px;margin-top: 2%;">
            Employee Details
          </h3>
          <tr>
            <td>
              <mat-form-field style="width: 175px;">
                <mat-label>Employee Code</mat-label>
                <input matInput placeholder="Employee Code" name="code" [value]="employee_code" [disabled]="true"
                  autocomplete="off" required>
              </mat-form-field>
            </td>
            <td>
              <mat-form-field style="width: 175px;padding-left: 50px;">
                <mat-label>Employee Name</mat-label>
                <input matInput placeholder="Employee Name" name="Name" [value]="employee_name" [disabled]="true"
                  autocomplete="off" required>
              </mat-form-field>
            </td>
            <td>
              <mat-form-field style="width: 175px;padding-left: 50px;">
                <mat-label>Designation</mat-label>
                <input matInput placeholder="Designation" name="designation" [value]="empdesignation" [disabled]="true"
                  autocomplete="off" required>
              </mat-form-field>
            </td>
            <td>
              <mat-form-field style="width: 175px;margin-left: 50px;">
                <mat-label>Employee Grade</mat-label>
                <input disabled matInput placeholder="Employee Grade" name="empgrade" [value]="empgrade"
                  autocomplete="off" required>
              </mat-form-field>
            </td>
            <td>
              <button type="button" class="btn btn-success btn-sm" data-toggle="modal" data-target="#ccbsModal"
                style="border-radius:40px; margin-left: 50px;">
                CCBS</button>
                <button type="button" class="btn btn-info btn-sm" data-toggle="modal" data-target="#approval"
                style="border-radius:40px; margin-left: 20px;">
                Approval Flow</button>
            </td>
  
          </tr>
  
  
  
        </table>
        <div class="table-responsive" style="width:100%;margin-top: 1%; overflow-x: hidden;">
          <table class="table table-bordered" fixed-header style="width: 99%;margin-top: 10px;">
            <thead class="table_header" style="text-align: left;">
              <tr>
                <th>S.No</th>
                <th>Reason</th>
                <th>Advance Amount</th>
                <th>Approved Amount</th>
                <th>CRN No</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let getclaim of advancedetail;index as i">
                <td>{{i+1}}</td>
               
                <td>
                  <div>{{getclaim.reason}}</div>
                </td>
                <td>{{getclaim.reqamount | currency:"INR"}}</td>
                <td>{{getclaim.appamount | currency:"INR"}}</td>
                <td>{{getclaim.crnno}}</td>
                <td>{{getclaim.status_name}}</td>
            </tbody>
            <tr>
  
              <th class="totaldisplay" colspan="2"></th>
              <td>Total Advance Amount:{{claimedamt | currency:"INR"}}</td>
              <td>
                Total Approved Amount :{{approvedamt | currency:"INR"}}
              </td>
              <td>
                <button type="button" class="btn btn-info btn-sm" (click)="getimages()" *ngIf="showeditfile"
                  style="border-radius: 40px;margin-left: 10px;" data-toggle="modal" data-target="#showattachmentpopup">
                  Attachment</button>
              </td>
              <th class="totaldisplay" colspan="5"></th>
            </tr>
          </table>
        </div>
        <td>
  
          <div class="modal fade" tabindex="-1"  data-backdrop="static" role="dialog" aria-labelledby="exampleModalLabels"
            aria-hidden="true" id="ccbsModal">
            <div class="modal-dialog modal-xl" style="width: 85%;">
              <div class="modal-content">
                <div  class="modal-header" style="background:#DDEFDD">
                  <h2 class="modal-title" style="width: 250px;margin-left: 20px;">CCBS (Tour No) : {{this.id}} </h2>
                  <div style="margin-left:39%">
                    <h2 class="modal-title" style="width: 250px;margin-left: 50px;">Approve Amount :
                      {{approvedamt}}</h2>
                  </div>
                  <button type="button" #closebutton class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
  
                <div   style="margin-left: 40px;margin-right: 40px;margin-top: 4%; width: 100%; margin-bottom: 2%;">
                    <div formArrayName='ccbs' style="margin-top: 4%; margin-bottom: 2%;" >
                      <div class="col-md-1" style="margin-top: -5%;margin-left: 84%; ">
                        <button type="button" class="btn btn-outline-success" matTooltip="Addccbs"
                          (click)="addccbs()"
                          style="border-radius:40px;"><span class="fa fa-plus"></span>
                        </button>
                     </div>
                  
                    <fieldset>
                      <table>
                        
                        <tr *ngFor="let dt2 of expenceform.controls.ccbs['controls'] ;let ind=index;"
                        [formGroupName]="ind">
                          <td>
                             
                            <mat-form-field style="width: 250px;margin-left: 20px;">
                              <mat-label>BS</mat-label>
                              <input required  id="ccbssearch" type="text" #bsid
                                placeholder="Select BS" matInput [matAutocomplete]="bsss" (keypress)="checkind(ind)"
                                formControlName="bsid">
                              <mat-autocomplete #bssid #bsss="matAutocomplete" (opened)="bsidget()"
                                [displayWith]="bsview">
                                <mat-option *ngFor="let bsid of bisinesslist" (click)="getBS(bsid.id,ind)"
                                  [value]="bsid">
                                  {{bsid.code}}-{{bsid.name}}
                                </mat-option>
                              </mat-autocomplete>
                            </mat-form-field>
                          </td>
                          <td>

                            <mat-form-field style="width: 250px;margin-left: 20px;">
                              <mat-label>CC</mat-label>
                              <input required  type="text" placeholder="Select CC"
                                matInput (keypress)="checkccind(ind)" [matAutocomplete]="csss"
                                formControlName="ccid">
                              <mat-autocomplete #csss="matAutocomplete" [displayWith]="csview">
                                <mat-option *ngFor="let ccid of costlist" [value]="ccid">
                                  {{ccid.code}}-{{ccid.name}}
                                </mat-option>
                              </mat-autocomplete>
                            </mat-form-field>
                          </td>

                          <td>
                            <mat-form-field style="width: 175px;margin-left: 20px;">
                              <mat-label>Claim Amount</mat-label>
                              <input matInput placeholder="Amount" (input)="ccbs_validation(ind,'amount')"
                                 formControlName="amount"
                                (blur)="percen_calc($event,ind)" appNumberOnly autocomplete="off" required>
                             <!-- {{this.value1}} -->
                            </mat-form-field>
                          </td>
                          <td>
                            <mat-form-field style="width: 175px;margin-left: 20px;">
                              <mat-label>Percentage</mat-label>
                              <input matInput placeholder="Percentage"  maxlength="4" (input)="ccbs_validation(ind)"
                                (blur)="amount_calc($event,ind)" appNumberOnly formControlName="percentage" 
                                pattern="^(?:100|[1-9][0-9]?|[1-9])$" required>
                              <!-- {{this.value}} -->
                            </mat-form-field>
                          </td>
                          <td>
                            <div style="width: 175px;margin-left: 35px;">
                              <button  class="btn btn-outline-danger" matTooltip="Delete"
                               
                                (click)="removeSection1(ind,dt2)" style="border-radius:40px;"><span
                                  class="fa fa-trash"></span>
                              </button>
                            </div>
                          </td>
                        </tr>
                      </table>
                    </fieldset>
                    <div class="col-md-11 text-center" style="margin-bottom: 4%;">

                      <button type="submit" style="border-radius: 40px;margin-left: 10px;" (click)="submitccbs()"
                          class="btn btn-success">Submit</button>

                      <button type="button" data-dismiss="modal" class="btn btn-danger"
                        style="border-radius: 40px;margin-left: 20px;">Close</button>

                    </div>
                    </div>

                </div>
  
              </div>
  
            </div>
          </div>
        </td>
        <div>
          <table align="center" style="margin-top: 3%;" *ngIf="applevel==2">
            <tr>
            
              <div style="border: 1px solid black;">
                <div style="margin: 10px 10px 10px 10px;">
                  <td>
                    Total Claimed Amount : {{claimedamt | currency:"INR"}}
                  </td>
                  <td style="padding-left: 50px;">
                    Advance to be Adjusted : {{sumadvance | currency:"INR"}}
  
                  </td>
  
                  <br>
  
            <tr>
              <td>
  
              </td>
              <td>
                Total Approved Amount : {{approvedamt | currency:"INR"}}
              </td>
              <td style="padding-left: 50px; padding-top: 4px;">
                <h3 style="color:blue;"> Net Payable : {{netpay | currency:"INR"}}</h3>
              </td>
            </tr>
        </div>
      </div>
      </table>
  </div>
  
  
  <div *ngIf="(applevel == 1 || applevel == 2) && changeapprover == false ">
    <mat-form-field style="width: 270px;">
      <mat-label>Action</mat-label>
      <mat-select formControlName='action' [disabled]="invalidpermission">
        <mat-option *ngFor="let expencetypee of action" (click)="actionchange()" [value]="expencetypee">
          {{expencetypee}}
        </mat-option>
      </mat-select>
    </mat-form-field>
  
  </div>
  <div *ngIf="actionapprove && !invalidpermission">
  
    <h3 style="color:rgb(0, 0, 0);font-size: 18px;font-weight: 500px;margin-top: 2%;">
      To Approve
    </h3>
    <fieldset [disabled]="invalidpermission" style="margin-top:-1%">
      <mat-form-field class="tabranch">
        <mat-label>Branch</mat-label>
        <input type="search" #inputassetid placeholder="Select Branch" matInput [matAutocomplete]="conoffice"
          [attr.disabled]="empbrid == true ? true : null" formControlName="empbranchid"><button mat-button matSuffix
          (click)="brclear()" mat-icon-button aria-label="Clear">
          <mat-icon>close</mat-icon>
        </button>
    
        <mat-autocomplete #assetid #conoffice="matAutocomplete" (opened)="autocompleteid()">
          <mat-option *ngFor="let branch of branchlist" (click)="selectBranch(branch.id)"
            [value]="'('+(branch.code)+') '+(branch.name)">
            ({{branch.code}}) {{branch.name}}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>
  
      <mat-form-field class="taemployee">
        <mat-label>Employee</mat-label>
        <input type="search" placeholder="Select Employee" matInput [matAutocomplete]="empc"
          [attr.disabled]="apvl == true ? true : null" formControlName="approval">
        <button mat-button matSuffix (click)="empclear()" mat-icon-button aria-label="Clear">
          <mat-icon>close</mat-icon>
        </button>
        <mat-autocomplete #empc="matAutocomplete" [displayWith]="displayFn">
          <mat-option *ngFor="let emp of employeelist" [value]="emp">
            ({{emp.code}}) {{emp.full_name}}-{{emp.employee_designation}}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>
  
  
  
  
      <mat-form-field class="tatextarea">
        <mat-label>Remarks</mat-label>
        <textarea cdkTextareaAutosize #autosize="cdkTextareaAutosize" cdkAutosizeMinRows="1" cdkAutosizeMaxRows="5"
          matInput placeholder="Remarks" (keypress)="omit_special_char($event)" (change)="remarksupdate($event)"
          formControlName="appcomment" autocomplete="off" required></textarea>
      </mat-form-field>
  
    </fieldset>
      <button [disabled]="submitvaluecheck()" type="submit"
        style="border-radius: 40px;margin-left: 40%;" class="btn btn-success"
        (click)="approvefirst()">Submit</button>
  
        <button type="button" (click)="back()" class="btn btn-success"
      style="border-radius: 40px;margin-left: 20px;">Back</button>
    
  </div>
  <div>
    <div class="modal fade" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true"
      id="showattachmentpopup">
      <div class="modal-dialog modal-xl " style="width: 70%;">
        <div class="modal-content">
          <div class="modal-header" style="background:rgba(23, 204, 23, 0.288);">
            <h2 class="modal-title" style="color:black ;text-align: center;">Tour Attachment View</h2>
            <button type="button"  data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
  
          <div *ngIf="attachmentlist.length > 0" style="margin-left: 50px;margin-right: 80%;margin-top: 2%; width: 80%;">
            <div class="container">
              <div class="row">
                <div class="table-responsive">
                  <table class="table table-bordered" fixed-header
                    style="width: 95%;margin-top: 10px;margin-left:30px;overflow-x: hidden;">
                    <thead class="table_header" style="text-align: left;">
                      <tr>
                        <th style="text-align: center;">S.No</th>
                        <th style="text-align: center;">File Name</th>
                        <th style="text-align: center;">View</th>
                        <th style="text-align: center;">Download</th>
  
  
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let attach of attachmentlist; index as i">
                        <td style="text-align: center;">{{i+1}}</td>
                        <td style="text-align: center;">{{attach.file_name}}</td>
                        <td style="text-align: center;color:blue;">
                          <div matTooltip="View" class="fa fa-arrow-up" aria-hidden="true" data-target="#exampleModal1"
                            data-toggle="modal" (click)="commentPopup(attach.id,attach.file_name )">
  
                        
                        
                          </div>
                        </td>
                     
                        <td style="text-align: center;">
                          <button class="btn btn-outline-primary" type="submit"
                            style="border-radius:40px;margin-left: 15px;" color="primary"
                            (click)="getimagedownload(attach.url,attach.file_name)">
                            <i matTooltip="Download" class="fa fa-download" aria-hidden="true"></i>
                          </button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
  
                </div>
              </div>
            </div>
  
  
          </div>
        </div>
      </div>
    </div>
  </div>
  
  
  
  <br>
  <!-- <div *ngIf="show_approvebtn" class="col-md-12 text-center" style="margin-bottom:2%;margin-top: -1%;">
  
    <mat-form-field style="width: 300px;" *ngIf="(actionreject || actionreturn || amtapprove) && !actionapprove">
      <input matInput type="text" placeholder="Reason" [disabled]="invalidpermission" [value]='reasonchange'
        (keypress)="omit_special_char($event)" (change)="reasonupdate($event)" required>
    </mat-form-field>
  
    <button type="submit" *ngIf="applevel==2 && amtapprove" matTooltip="Approve"
      style="border-radius: 40px;margin-left: 30px;" class="btn btn-outline-success"
      (click)="approveclaim()">Approve</button>
  
    <button type="submit"
      *ngIf="actionreject"
      [disabled]="reapprove" MatTooltip="Reject" style="border-radius: 40px;margin-left: 30px;" class="btn btn-outline-danger"
      (click)="rejectclaim()">Reject</button>
  
    <button type="submit" matTooltip="Return"
      *ngIf="actionreturn"
      [disabled]="reapprove" style="border-radius: 40px;margin-left: 30px;" class="btn btn-outline-secondary"
      (click)="returnclaim()">Return</button>
      <button type="button" matTooltip="Submit" (click)="submitForm()" class="btn btn-success"
      style="border-radius: 40px;margin-left: 20px;">Submit</button>

  <button type="button" matTooltip="Return"  class="btn btn-outline-secondary"
    (click)="returnclaim()" style="border-radius: 40px;margin-left: 20px;">Return</button>
    <button type="button" matTooltip="Back" *ngIf="!actionapprove" (click)="back()" class="btn btn-primary"
      style="border-radius: 40px;margin-left: 20px;">Back</button>
  
  
  </div> -->
<mat-form-field style="width: 300px;" >
    <input matInput type="text" placeholder="Reason"[value]='reasonchange' 
      (keypress)="omit_special_char($event)" (change)="reasonupdate($event)" required>
  </mat-form-field>
  <div class="text-center row">
    <!-- <button type="button" matTooltip="Return"  class="btn btn-info btn-sm"
    (click)="returnExpenceCheckerclaim()" style="border-radius: 40px;margin-left: 20px;">Return Expence Approver</button>
    <button type="button" matTooltip="Return"  class="btn btn-info btn-sm"
    (click)="returnTourMaker()" style="border-radius: 40px;margin-left: 20px;">Return To Initiater</button>
    <button type="button" matTooltip="Reject"  class="btn btn-danger btn-sm"
     style="border-radius: 40px;margin-left: 20px;" (click)="rejectclaim()">Reject</button> -->
     <button type="button" class="btn btn-success btn-sm"
              (click)="approve_pay()" data-dismiss="modal" style="border-radius: 40px; margin-left: 20px;">Approve and Pay</button>
              <button type="button" (click)="back()" class="btn btn-primary btn-sm"
              style="border-radius: 40px;margin-left: 20px;">Back</button>
   </div>
   <br>

  
  
  <!-- <div *ngIf="advance_statusid != -1" class="table-responsive" style="width:70%;margin-top: 1%; overflow-x: hidden;">
    <h2 style="color:rgb(0, 0, 0);font-size: 18px;font-weight: 500px;">Advance Adjust</h2>
    <table class="table table-bordered" fixed-header>
      <thead class="table_header" style="text-align: left;">
        <tr>
          <th>S.No</th>
          <th>CRN No</th>
          <th>Date</th>
          <th>Amount</th>
          <th>Balance</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let advance of advancelist|paginate: { id:'advpagination',itemsPerPage: pageadsize, currentPage: presentpage }; index as i">
  
          <td>
  
          </td>
          <td>
  
          </td>
          <td>
  
          </td>
          <td>
  
          </td>
          <td>
  
          </td>
        </tr>
        <tr>
          <th colspan="7">
            <div class="pagination" style="text-align: center;">
              <pagination-controls responsive="true" id="advpagination" (pageChange)="presentpage = $event">
              </pagination-controls>
            </div>
          </th>
        </tr>
      </tbody>
    </table>
  </div> -->
  <div class="modal fade" tabindex="-1"  data-backdrop="static" role="dialog" aria-labelledby="exampleModalLabels"
  aria-hidden="true" id="approval">
  <div class="modal-dialog modal-xl " style="width: 80%;">
    <div class="modal-content">
      <div class="modal-header"  style="background: rgba(69, 239, 69, 0.288);">
        <h2 class="modal-title" style="color:black ;text-align: center;font-weight: bold;">Approval Flow</h2>
        <button type="button" class="close" data-dismiss="modal" #closefile aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
  <div class="table-responsive" style="width:100%;margin-top: 1%; margin-bottom: 2%; margin-left: 100px; overflow-x: hidden;">
    <table class="table table-bordered" fixed-header style="width: 80%;margin-top: 10px;">
      <thead class="table_header" style="text-align: left;">
        <tr>
          <th>S.No</th>
          <th>Date</th>
          <th>Type </th>
          <th>Employee</th>
          <th>Raised By</th>
  
          <th>Remarks</th>
          <th>Status</th>
  
        </tr>
      </thead>
  
      <tbody>
      <tbody>
        <tr
          *ngFor="let advanceapprove of getAdvanceapproveList|paginate: { itemsPerPage: pageSize, currentPage: p }; index as i">
          <td scope="row" style="vertical-align: middle;"> {{((p-1)*pageSize)+i+1}}</td>
          <td>{{advanceapprove.approveddate| date:'dd-MMM-yyyy'}}</td>
          <td>{{advanceapprove.apptype}}</td>
          <td>({{advanceapprove.approver_code}}) {{advanceapprove.approvedby}}</td>
          <td>({{advanceapprove.onbehalfof.code}}) {{advanceapprove.onbehalfof.full_name}}</td>
  
          <td style="overflow-wrap:anywhere">{{advanceapprove.comment}}</td>
          <td>
            <p *ngIf="advanceapprove.status == 1">
              REQUESTED</p>
            <p *ngIf="advanceapprove.status == 2">
              PENDING</p>
            <p *ngIf="advanceapprove.status == 3">
              APPROVED</p>
            <p *ngIf="advanceapprove.status == 4">
              REJECTED</p>
            <p *ngIf="advanceapprove.status == 5">
              RETURNED</p>
            <p *ngIf="advanceapprove.status == 6"> Tour Advance Submitted</p>
            <p *ngIf="advanceapprove.status == 17">
              Tour Advance Cancel Submitted</p>
  
  
          </td>
      </tbody>
      <tr>
        <th colspan="7">
          <div class="pagination">
            <pagination-controls responsive="true" (pageChange)="p = $event"></pagination-controls>
          </div>
        </th>
      </tr>
    </table>
  </div>
  </div>
  </div>
  </div>   
  </div>
  

  </form>
  </div> 
</div>

<div *ngIf="TA_DailyDim_Enb">
  <app-dailydiem-expence (expense_navigate_n)="expense_navigate()"></app-dailydiem-expence>
</div>

<div *ngIf="TA_ExpenceData_Enb">
  <app-traveling-expence (expense_navigate_n)="expense_navigate()"></app-traveling-expence>
</div>

<div *ngIf="TA_Lodge_Enb">
  <app-lodging-expence (expense_navigate_n)="expense_navigate()"></app-lodging-expence>
</div>
<div *ngIf="TA_Inci_Enb">
  <app-incidental-expence  (expense_navigate_new)="expense_navigate()"></app-incidental-expence>
</div>
<div *ngIf="TA_Local_Enb">
  <app-localconveyance-expense (expense_navigate_new)="expense_navigate()"></app-localconveyance-expense>
</div>
<div *ngIf="TA_Misc_Enb">
  <app-miscellaneous-expence (expense_navigate_new)="expense_navigate()"></app-miscellaneous-expence>
</div>
<div *ngIf="TA_Pack_Enb">
  <app-packing-expence (expense_navigate_new)="expense_navigate()"></app-packing-expence>
</div>
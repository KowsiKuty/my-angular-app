<div style="padding: 1%;">

    <h2>Vendor Acknowledgement</h2>
    <br>
    <form [formGroup]="summaryform" style="padding-left: 1%;">
        <!-- <section role="search" class="row products">
              <div class="col-md-3" class="npm-mat-edit" >
                    <mat-form-field appearance="outline" style="width: 100%;">
                        <mat-label>CR NO </mat-label>
                        <input matInput formControlName="cr_no" >
                    </mat-form-field>
                </div>
            <div class="col-md-3" class="npm-mat-edit" style="padding-left: 2%;">
                <mat-form-field class="npm-mat-edit" (click)="getvendorValue('')" matTooltip="{{vendor_input.value}}"
                    appearance="outline">
                    <mat-label>Vendor</mat-label>
                    <input #vendor_input type="text" matInput formControlName="vendor" [matAutocomplete]="vendor_auto"
                        (keyup)="getvendorValue($event.target.value)">
                    <mat-autocomplete #vendor_auto="matAutocomplete" (opened)="vendor_Scroll()"
                        [displayWith]="vendor_display">
                        <mat-option *ngFor="let vendor of vendorlist" [value]="vendor" matTooltip={{vendor.name}}>
                            {{vendor.name}}
                        </mat-option>
                    </mat-autocomplete>
                </mat-form-field>
            </div>
            <div class="col-md-3" class="npm-mat-edit" style="padding-left: 2%;">
                <mat-form-field class="npm-mat-edit" appearance="outline">
                    <mat-label>Archival Date</mat-label>
                    <input matInput [matDatepicker]="picker3" placeholder="Date" autocomplete="off"
                        formControlName="archival_date" readonly>
                    <mat-datepicker-toggle class="rmudatetoggle" matSuffix [for]="picker3">
                    </mat-datepicker-toggle>
                    <mat-datepicker #picker3 startView="multi-year"></mat-datepicker>
                </mat-form-field>
            </div>
            <div class="col-md-3" class="npm-mat-edit" style="padding-left: 2%;">
                <mat-form-field class="npm-mat-edit" (click)="box_name('')" matTooltip="{{box_name_input.value}}"
                    appearance="outline">
                    <mat-label>Box Name</mat-label>
                    <input #box_name_input type="text" matInput formControlName="box_names"
                        [matAutocomplete]="box_name_auto" (keyup)="box_name($event.target.value)">
                    <mat-autocomplete #box_name_auto="matAutocomplete" (opened)="box_name_Scroll()"
                        [displayWith]="vendor_display">
                        <mat-option *ngFor="let box of box_name_DownData" [value]="box" matTooltip={{box.name}}>
                            {{box.name}}
                        </mat-option>
                    </mat-autocomplete>
                </mat-form-field>
            </div>
            <div class="npm-mat-edit" style="padding-left: 2%;">
                <mat-form-field appearance="outline" class="npm-mat-edit" (click)="status_ddown()">
                    <mat-label>Status</mat-label>
                    <mat-select matInput formControlName="status_name">
                        <mat-option *ngFor="let status of status_listed" [value]="status">
                            {{status.name}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
            <div class="col-md-4">
                <button matTooltip="Search Records" matTooltipClass="rmutooltip" (click)="getsummary()"
                    class="btn btn-outline-success" style="margin-left:5%" id="rmubtn" color="primary"><i
                        class="fa fa-search" aria-hidden="true"></i></button>
                <button class="btn btn-warning" matTooltipClass="rmutooltip" (click)="summaryform_reset()"
                    [matTooltip]="'Clear Entries'" style="margin-left:20px" id="rmubtn">Clear</button>

                <button class="btn btn-outline-success" matTooltipClass="rmutooltip"
                    *ngIf="selectedFile || selectedFiles" (click)="submit('')" [matTooltip]="'Acknowledgement Submit'"
                    style="margin-left:20px" id="rmubtn">Submit</button>
                <span class="file-upload-wrapper" style="padding-left: 2%;" *ngIf="checkbox_select===true">
                    <label for="file-upload" class="btn btn-outline-success" matTooltipClass="rmutooltip"
                        [matTooltip]="'Upload File'" style="cursor: pointer;">
                        <i class="fa fa-upload"></i>
                    </label>
                    <input id="file-upload" type="file" formControlName="file_fas_upload" accept=".pdf,.jpg,.jpeg,.png"
                        class="choose" style="display: none;" (change)="ack_file_data($event)"
                        [disabled]="hole_select===false">
                    <ng-container *ngIf="selectedFiles" class="selected-file">
                        {{ selectedFiles.name }}
                    </ng-container>
                </span>

            </div>
        </section> -->
        <section role="search" class="row products" style="align-items: flex-end; gap: 1rem;">

            <!-- CR No -->
            <div class="col-md-2" class="npm-mat-edit">
                <mat-form-field appearance="outline" style="width: 100%;">
                    <mat-label>CR NO</mat-label>
                    <input matInput formControlName="cr_no">
                </mat-form-field>
            </div>

            <!-- Vendor -->
            <div class="col-md-2" class="npm-mat-edit">
                <mat-form-field appearance="outline" style="width: 100%;" (click)="getvendorValue('')"
                    matTooltip="{{vendor_input.value}}">
                    <mat-label>Vendor</mat-label>
                    <input #vendor_input type="text" matInput formControlName="vendor" [matAutocomplete]="vendor_auto"
                        (keyup)="getvendorValue($event.target.value)">
                    <mat-autocomplete #vendor_auto="matAutocomplete" (opened)="vendor_Scroll()"
                        [displayWith]="vendor_display">
                        <mat-option *ngFor="let vendor of vendorlist" [value]="vendor" matTooltip="{{vendor.name}}">
                            {{vendor.name}}
                        </mat-option>
                    </mat-autocomplete>
                </mat-form-field>
            </div>

            <!-- Archival Date -->
            <div class="col-md-2" class="npm-mat-edit">
                <mat-form-field appearance="outline" style="width: 100%;">
                    <mat-label>Archival Date</mat-label>
                    <input matInput [matDatepicker]="picker3" placeholder="Date" autocomplete="off"
                        formControlName="archival_date" readonly>
                    <mat-datepicker-toggle matSuffix [for]="picker3"></mat-datepicker-toggle>
                    <mat-datepicker #picker3 startView="multi-year"></mat-datepicker>
                </mat-form-field>
            </div>

            <!-- Box Name -->
            <div class="col-md-2" class="npm-mat-edit">
                <mat-form-field appearance="outline" style="width: 100%;" (click)="box_name('')"
                    matTooltip="{{box_name_input.value}}">
                    <mat-label>Box Name</mat-label>
                    <input #box_name_input type="text" matInput formControlName="box_names"
                        [matAutocomplete]="box_name_auto" (keyup)="box_name($event.target.value)">
                    <mat-autocomplete #box_name_auto="matAutocomplete" (opened)="box_name_Scroll()"
                        [displayWith]="vendor_display">
                        <mat-option *ngFor="let box of box_name_DownData" [value]="box" matTooltip="{{box.name}}">
                            {{box.name}}
                        </mat-option>
                    </mat-autocomplete>
                </mat-form-field>
            </div>

            <!-- Status -->
            <div class="col-md-2" class="npm-mat-edit">
                <mat-form-field appearance="outline" style="width: 100%;" (click)="status_ddown()">
                    <mat-label>Status</mat-label>
                    <mat-select formControlName="status_name">
                        <mat-option *ngFor="let status of status_listed" [value]="status">
                            {{status.name}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </div>

            <!-- Buttons -->
            <!-- Buttons -->
            <div class="col-md-2 d-flex align-items-end" style="gap: 10px; padding-bottom: 25px;">
                <button matTooltip="Search Records" class="btn btn-outline-success" (click)="getsummary()" id="rmubtn">
                    <i class="fa fa-search" aria-hidden="true"></i>
                </button>

                <button class="btn btn-warning" (click)="summaryform_reset()" matTooltip="Clear Entries" id="rmubtn">
                    Clear
                </button>

                <button class="btn btn-outline-success" *ngIf="selectedFile || selectedFiles" (click)="submit('')"
                    matTooltip="Acknowledgement Submit" id="rmubtn">
                    Submit
                </button>

                <label *ngIf="chechbox_id.length" for="file-upload" class="btn btn-outline-success"
                    matTooltip="Upload File" style="cursor: pointer; margin-bottom: 0;">
                    <i class="fa fa-upload"></i>
                </label>
                <input id="file-upload" type="file" formControlName="file_fas_upload" accept=".pdf,.jpg,.jpeg,.png"
                    style="display: none;" (change)="ack_file_data($event)" [disabled]="hole_select === false">

                <ng-container *ngIf="selectedFiles" class="text-truncate" style="max-width: 100%;">
                    {{ selectedFiles.name }}
                </ng-container>
            </div>



        </section>

    </form>
    <div id="rmucontent" class="table-responsive" style="margin-top: 2%;">
        <table class="table table-bordered" id="rmutable">
            <thead class="table_header" style="top:0;position: sticky;z-index: 2; background-color: #ddefdd;">
                <tr>
                    <th>S.No</th>
                    <th>Box No</th>
                    <th>Box Name</th>
                    <th>Product</th>
                    <th>Batch Name</th>
                    <th>Archival Date</th>
                    <th>Archival Status</th>
                    <th>Vendor Barcode</th>
                    <th>Document Count</th>
                    <th>Storage Vendor</th>
                    <th>Created Date</th>
                    <th>Occupied Count</th>
                    <th>File Upload</th>
                    <th class="icon_width">File View</th>
                    <th>
                        <!-- Select ({{(chechbox_id?.length + occupied_counts) || 0 }}/{{(document_count_data) ||
                        0}}) -->
                        <mat-checkbox [checked]="ischeckedall" (change)="toggleCheckboxAll($event)"
                            [disabled]="hole_select===false">
                        </mat-checkbox>

                    </th>

                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let summary of summarylist;let i=index">
                    <td>{{(pagination.index-1)*10+i + 1 }}</td>
                    <td>{{summary?.box_number}}</td>
                    <td>{{summary?.box_data?.name}}</td>
                    <td>{{summary?.product_data?.name}}</td>
                    <td>{{summary?.batch_id}}</td>
                    <td> {{ summary?.archival_data?.archival_date !="None" ?
                        (summary?.archival_data?.archival_date | date:'dd-MMM-yyyy') : ''
                        }}</td>
                    <td>{{summary?.archival_data?.archival_status===1 ?'Ready For Dispatch':
                        (summary?.archival_data?.archival_status==3 ?'Archived':'Acknowledgement Received')}}</td>
                    <td>{{summary?.archival_data?.vendor_barcode}}</td>
                    <td>{{summary?.box_count}}</td>
                    <td>{{summary?.archival_data?.vendor_id?.name}}</td>
                    <td>{{summary?.crated_date | date:'dd-MMM-yyyy'}}</td>
                    <td>{{summary?.occupied_count}}</td>
                    <td class="PositionRe">
                        <label class="custom-file-upload PositionRel" style="cursor: 'pointer'" [ngClass]="summary?.disable==true || chechbox_id.length?'PointerEventsNone':''">
                            <input type="file" class="InputFile"  accept=".pdf,.jpg,.jpeg,.png"
                                (change)="ack_files_data($event, summary)" [disabled]="summary?.selected">
                        </label>
                        <div class="IconFlex">
                            <!-- <i class="fa fa-cloud-upload  fa-lg"></i> -->
                             <mat-icon [ngClass]="summary?.disable==true || chechbox_id.length?'OpacityHalf':''">cloud_upload</mat-icon>
                            <mat-icon *ngIf="summary?.selectedFile" (click)="removeFile(summary)" type="button"
                                class="delete-file-btn">cancel</mat-icon>
                        </div>
                        <span *ngIf="summary?.selectedFile" class="selected-file">
                            {{ summary?.selectedFile?.name }}
                        </span>
                    </td>

                    <td>
                        <div class="row" style="display: flex; align-items: center; margin-left: 5%;">
                            <button mat-icon-button matTooltipClass="rmutooltip" [matTooltip]="'File View'"
                                class="iconbutton" color="primary" style="color: green;"
                                (click)="master_view_data(summary)" id="rmubtn">
                                <mat-icon class="enabled_icon" aria-label="view">
                                    visibility
                                </mat-icon>
                            </button>
                        </div>

                    </td>
                    <td>
                        <mat-checkbox [checked]="summary?.checked" (change)="singleCheckbox($event, summary)"
                            [disabled]="hole_select===false">
                        </mat-checkbox>
                    </td>
                </tr>
            </tbody>
        </table>
        <div *ngIf="!summarylist?.length" style="margin-left: 42%;">
            <h3>Sorry no data found!... </h3>
        </div>

        <div class="col-sm-12" style="font-size: small;text-align:right;margin-bottom: 5%;">
            <button (click)="prevpage()" mat-icon-button [disabled]="pagination.has_previous === false" color="primary">
                <mat-icon>arrow_back</mat-icon>
            </button>
            {{pagination.index}}
            <button (click)="nextpage()" mat-icon-button [disabled]="pagination.has_next === false" color="primary">
                <mat-icon>arrow_forward</mat-icon>
            </button>

        </div>
    </div>
</div>

<div class="modal" id="viewDownload" role="dialog" aria-labelledby="viewDownload" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content" style="width: 800px;">

            <div class="modal-header" id="viewDownload" style="width: 800px; ">
                <h5 class="modal-title" id="viewDownload" style="text-align: center; font-size: large;">
                    View File
                </h5>
                <mat-icon style="margin-left: 7%; font-size: 25px; cursor: pointer;" matTooltip="File Download"
                    (click)="onDownload()">cloud_download</mat-icon>

                <button type="button" class="close" data-dismiss="modal" aria-label="Close" #closebutton>
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body">
                <div class="row">
                    <div class="col-lg-12 col-sm-12" fxLayoutAlign="space-between">
                        <pdf-viewer *ngIf="pdfshow" [src]="pdfsrc" [original-size]="false" [render-text]="false"
                            [show-borders]="true" [fit-to-page]="true" [show-all]="true"
                            style="display: block; height: 500px;">
                        </pdf-viewer>
                        <!-- <img *ngIf="imgshow" [src]="filesrc" class="img-responsive"
                            style="display: block; border-width: 2px; border-style: solid; width: 100%;" /> -->
                        <!-- <div style="max-width: 100%; max-height: 600px; overflow: auto; border: 2px solid;">
                                <img *ngIf="imgshow" [src]="filesrc" class="img-responsive"
                                     style="display: block; width: 100%;"  />
                              </div> -->
                        <!-- <div style="overflow: hidden; max-width: 100%; border: 2px solid;">
                                <img *ngIf="imgshow" [src]="filesrc" class="img-responsive"
                                     style="width: 100%; transition: transform 0.3s; cursor: zoom-in;"
                                     (mouseover)="zoomIn($event)" (mouseout)="zoomOut($event)" />
                              </div> -->

                        <!-- <div style="overflow: hidden; max-width: 100%; border: 2px solid; position: relative;">
                                <img *ngIf="imgshow" [src]="filesrc" class="img-responsive"
                                     [style.transform]="'scale(' + zoomLevel + ')'"
                                     style="transition: transform 0.3s; width: 100%; display: block;" />
                                <button (click)="zoomIn()" style="position: absolute; top: 10px; left: 10px; z-index: 1;">Zoom In</button>
                                <button (click)="zoomOut()" style="position: absolute; top: 10px; left: 90px; z-index: 1;">Zoom Out</button>
                              </div> -->
                        <div
                            style="overflow: auto;max-height: 500px; max-width: 100%; border: 2px solid; position: relative;">
                            <img *ngIf="imgshow" [src]="filesrc" class="img-responsive"
                                [style.transform]="'scale(' + zoomLevel + ')'"
                                style="transition: transform 0.3s; width: 100%; display: block; cursor: pointer;"
                                (mousemove)="zoomImage($event)" (click)="toggleZoom()" />
                        </div>


                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
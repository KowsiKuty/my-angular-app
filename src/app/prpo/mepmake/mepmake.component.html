<div>
  <form [formGroup]="MEPmakerForm">
    <div style="margin: 3%">
      <h2>Project Component Approval (PCA) Maker</h2>
      <div *ngIf="isEnable && isBudgetedReadonly">
        <div *ngIf="statusShow === 'APPROVED'" style="text-align: center">
          <div class="alert alert-success" role="alert">
            PCA Status : "{{ statusShow }}" &nbsp; &nbsp; Remarks: "{{
              justification_remarksStatus
            }}"
          </div>
        </div>
        <div *ngIf="statusShow === 'REJECTED'" style="text-align: center">
          <div class="alert alert-danger" role="alert">
            PCA Status : "{{ statusShow }}" &nbsp; &nbsp; Remarks: "{{
              justification_remarksStatus
            }}"
          </div>
        </div>
        <div
          *ngIf="statusShow === 'MODIFICATION-APPROVAL'"
          style="text-align: center"
        >
          <div class="alert alert-warning" role="alert">
            PCA Status : "{{ statusShow }}" &nbsp; &nbsp; Remarks: "{{
              justification_remarksStatus
            }}"
          </div>
        </div>
        <!-- <ng-template #error>
          <div
            class="alert alert-secondary"
            role="alert"
            style="text-align: center"
          >
            PCA Status : "{{ statusShow }}" &nbsp; &nbsp; Remarks: "{{
              justification_remarksStatus
            }}"
          </div>
        </ng-template> -->
      
        <!-- <span class="mb-2" *ngIf="isopex"
        >BPA Total Amount:{{
          amoun | amountPipeCustom
        }}
        &nbsp;&nbsp;&nbsp;&nbsp; Approved Amount:{{
          mepappr | amountPipeCustom
        }}
        &nbsp;&nbsp;&nbsp;Pending Approval Amount:{{
          pendamt | amountPipeCustom
        }}&nbsp;&nbsp;&nbsp; Balance Amount:{{
          balanceAmount | amountPipeCustom
        }}</span
      > -->
      </div>
        <div *ngIf="iscapex" class="row mb-5 ml-5">
          <span class="border-box">
            BPA Total Amount : {{ amoun | amountPipeCustom }}
          </span>

          &nbsp;&nbsp;
          <span class="border-box">
            Approved Amount : {{ mepappr | amountPipeCustom }}
          </span>
          &nbsp;&nbsp;
          <span class="border-box">
            Pending Approval Amount : {{ pendamt | amountPipeCustom }}
          </span>
          &nbsp;&nbsp;
          <span class="border-box">
            Balance Amount : {{ balanceAmount | amountPipeCustom }}
          </span>
        
    </div>

      <table>
        <tr>
          <td>
            <mat-form-field style="width: 175px; margin-left: 50px">
              <mat-label>PCA Number</mat-label>
              <input
                matInput
                placeholder="PCA Number"
                formControlName="no"
                readonly
              />
            </mat-form-field>
          </td>
          <td>
            <mat-form-field style="width: 175px; margin-left: 50px">
              <mat-label>PCA Name</mat-label>
              <input
                matInput
                placeholder="PCA Name"
                (keypress)="only_numalpha($event)"
                autocomplete="off"
                formControlName="name"
                required
                [readonly]="isEnable"
              />
            </mat-form-field>
          </td>
          <td>
            <mat-form-field
              style="width: 200px; margin-left: 50px"
              (click)="getparnoFK()"
            >
              <mat-label>Select BPA Number </mat-label>
              <input
                #parnoInput
                placeholder="Select BPA Number"
                matInput
                formControlName="parno"
                [matAutocomplete]="parno"
                (keypress)="only_numalpha($event)"
                [readonly]="isEnable"
              />
              <mat-autocomplete
                #parno="matAutocomplete"
                [displayWith]="displayFnparno.bind(this)"
                (opened)="autocompleteparnoScroll()"
              >
                <mat-option *ngIf="isLoading" class="is-loading"
                  >Loading...</mat-option
                >
                <ng-container *ngIf="!isLoading">
                  <mat-option
                    *ngFor="let parno of parnoList"
                    (click)="meptotalget()"
                    [value]="parno.no"
                    title="{{ parno.no }}--{{ parno.desc }}"
                  >
                    {{ parno.no }}--{{ parno.desc }}
                  </mat-option>
                </ng-container>
              </mat-autocomplete>
            </mat-form-field>
          </td>
          <td>
            <mat-form-field style="width: 175px; margin-left: 50px">
              <mat-label>Choose Expense</mat-label>
              <mat-select formControlName="type" [disabled]="isEnable">
                <mat-option
                  *ngFor="let type of expensetype"
                  (click)="meptotalget()"
                  [value]="type.text"
                >
                  {{ type.text }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </td>
        </tr>
        <tr>
          <td>
            <mat-form-field style="width: 175px; margin-left: 50px">
              <mat-label> PCA Amount</mat-label>
              <input
                matInput
                placeholder="PCA Amount"
                type="number"
                (keypress)="omit_hyphen($event)"
                [readonly]="isEnable"
                min="1"
                (keypress)="omit_special_num($event)"
                autocomplete="off"
                formControlName="amount"
                required
              />
            </mat-form-field>
          </td>
          <td>
            <mat-form-field style="width: 175px; margin-left: 50px">
              <mat-label>Choose Start Date</mat-label>
              <input
                matInput
                readonly
                [matDatepicker]="picker1"
                placeholder="Start Date"
                formControlName="startdate"
                required
              />
              <mat-datepicker-toggle
                matSuffix
                [for]="picker1"
                [disabled]="isEnable"
              ></mat-datepicker-toggle>
              <mat-datepicker #picker1 [disabled]="isEnable"></mat-datepicker>
            </mat-form-field>
          </td>
          <td>
            <mat-form-field style="width: 175px; margin-left: 50px">
              <mat-label>Choose End Date</mat-label>
              <input
                matInput
                readonly
                [matDatepicker]="picker2"
                placeholder="End Date"
                formControlName="enddate"
                required
              />
              <mat-datepicker-toggle
                matSuffix
                [for]="picker2"
                [disabled]="isEnable"
              ></mat-datepicker-toggle>
              <mat-datepicker #picker2 [disabled]="isEnable"></mat-datepicker>
            </mat-form-field>
          </td>
          <td>
            <mat-form-field style="width: 175px; margin-left: 50px">
              <mat-label>Fin Year</mat-label>
              <mat-select formControlName="finyear" [disabled]="isEnable">
                <mat-option
                  *ngFor="let year of FinancialYearList"
                  [value]="year.text"
                >
                  {{ year.text }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </td>
        </tr>
        <tr>
          <td>
            <mat-form-field
              style="width: 200px; margin-left: 50px"
              (click)="getbranchFK()"
            >
              <mat-label>Select Branch Code</mat-label>
              <input
                #branchInput
                placeholder="Select Branch Code"
                matInput
                formControlName="branch_id"
                [readonly]="isEnable"
                [matAutocomplete]="branch"
                (keypress)="only_numalpha($event)"
              />
              <mat-error
                *ngIf="MEPmakerForm.controls.branch_id.errors?.incorrectValue"
              >
                {{ MEPmakerForm.controls.branch_id.errors?.incorrectValue }}
              </mat-error>
              <mat-autocomplete
                #branch="matAutocomplete"
                [displayWith]="displayFnbranch.bind(this)"
                (opened)="autocompletebranchScroll()"
              >
                <mat-option *ngIf="isLoading" class="is-loading"
                  >Loading...</mat-option
                >
                <ng-container *ngIf="!isLoading">
                  <mat-option
                    *ngFor="let branch of branchList"
                    [value]="branch"
                  >
                    {{ branch.code }}-{{ branch.name }}
                  </mat-option>
                </ng-container>
              </mat-autocomplete>
            </mat-form-field>
          </td>

          <td>
            <div style="margin-left: 50px">
              <mat-label> Is Budgeted</mat-label>
              <mat-radio-group
                formControlName="budgeted"
                [disabled]="isBudgetedReadonly"
              >
                <mat-radio-button
                  *ngFor="let n of yesorno"
                  [value]="n.value"
                  style="margin-left: 10px"
                >
                  {{ n.display }}
                </mat-radio-button>
              </mat-radio-group>
            </div>
          </td>
          <td>
            <mat-form-field
              style="width: 200px; margin-left: 50px"
              (click)="getraisorFK()"
            >
              <mat-label>Select Raiser Name</mat-label>
              <input
                #raisorInput
                placeholder="Select Raiser"
                matInput
                formControlName="raisor_id"
                [readonly]="isEnable"
                [matAutocomplete]="raisor"
                (keypress)="only_numalpha($event)"
              />
              <mat-error
                *ngIf="MEPmakerForm.controls.raisor_id.errors?.incorrectValue"
              >
                {{ MEPmakerForm.controls.raisor_id.errors?.incorrectValue }}
              </mat-error>
              <mat-autocomplete
                #raisor="matAutocomplete"
                [displayWith]="displayFnraisor.bind(this)"
                (opened)="autocompleteraisorScroll()"
              >
                <mat-option *ngIf="isLoading" class="is-loading"
                  >Loading...</mat-option
                >
                <ng-container *ngIf="!isLoading">
                  <mat-option *ngFor="let emp of raisorList" [value]="emp"
                    >{{ emp.full_name }}
                  </mat-option>
                </ng-container>
              </mat-autocomplete>
            </mat-form-field>
          </td>
          <td>
            <mat-form-field
              style="width: 200px; margin-left: 50px"
              (click)="getprojectownerFK()"
            >
              <mat-label>Select Project Owner </mat-label>
              <input
                #projectownerInput
                placeholder="Select Project Owner"
                matInput
                [readonly]="isEnable"
                formControlName="projectowner_id"
                [matAutocomplete]="projectowner"
                (keypress)="only_numalpha($event)"
              />
              <mat-error
                *ngIf="
                  MEPmakerForm.controls.projectowner_id.errors?.incorrectValue
                "
              >
                {{
                  MEPmakerForm.controls.projectowner_id.errors?.incorrectValue
                }}
              </mat-error>
              <mat-autocomplete
                #projectowner="matAutocomplete"
                [displayWith]="displayFnprojectowner.bind(this)"
                (opened)="autocompleteprojectownerScroll()"
              >
                <mat-option *ngIf="isLoading" class="is-loading"
                  >Loading...</mat-option
                >
                <ng-container *ngIf="!isLoading">
                  <mat-option *ngFor="let emp of projectownerList" [value]="emp"
                    >{{ emp.full_name }}
                  </mat-option>
                </ng-container>
              </mat-autocomplete>
            </mat-form-field>
          </td>
        </tr>
        <tr>
          <td>
            <mat-form-field
              style="width: 200px; margin-left: 50px"
              (click)="getrequestforFK()"
            >
              <mat-label>Select Request For</mat-label>
              <input
                #rforInput
                placeholder="Search Request For"
                matInput
                formControlName="requestfor"
                [readonly]="isEnable"
                [matAutocomplete]="rfor"
                (keypress)="only_numalpha($event)"
              />
              <mat-autocomplete
                #rfor="matAutocomplete"
                [displayWith]="displayFnrfor.bind(this)"
                (opened)="autocompleterforScroll()"
              >
                <mat-option *ngIf="isLoading" class="is-loading"
                  >Loading...</mat-option
                >
                <ng-container *ngIf="!isLoading">
                  <mat-option
                    *ngFor="let rfor of requestforList"
                    [value]="rfor.name"
                    >{{ rfor.name }}
                  </mat-option>
                </ng-container>
              </mat-autocomplete>
            </mat-form-field>
          </td>
          <td>
            <mat-form-field
              style="width: 200px; margin-left: 50px"
              (click)="getbudgetownerFK()"
            >
              <mat-label>Select Budget Owner </mat-label>
              <input
                #budgetownerInput
                placeholder="Select Budget Owner"
                matInput
                [readonly]="isEnable"
                formControlName="budgetowner_id"
                [matAutocomplete]="budgetowner"
                (keypress)="only_numalpha($event)"
              />
              <mat-error
                *ngIf="
                  MEPmakerForm.controls.budgetowner_id.errors?.incorrectValue
                "
              >
                {{
                  MEPmakerForm.controls.budgetowner_id.errors?.incorrectValue
                }}
              </mat-error>
              <mat-autocomplete
                #budgetowner="matAutocomplete"
                [displayWith]="displayFnbudgetowner.bind(this)"
                (opened)="autocompletebudgetownerScroll()"
              >
                <mat-option *ngIf="isLoading" class="is-loading"
                  >Loading...</mat-option
                >
                <ng-container *ngIf="!isLoading">
                  <mat-option *ngFor="let emp of budgetownerList" [value]="emp"
                    >{{ emp.full_name }}
                  </mat-option>
                </ng-container>
              </mat-autocomplete>
            </mat-form-field>
          </td>
          <td>
            <mat-form-field style="width: 175px; margin-left: 50px">
              <mat-label>Justification</mat-label>
              <input
                matInput
                placeholder="Justification"
                (keypress)="omit_special_char($event)"
                autocomplete="off"
                formControlName="justification"
                required
                [readonly]="isEnable"
              />
            </mat-form-field>
          </td>
          <td>
            <!-- <button
              type="button"
              data-toggle="modal"
              role="button"
              data-target=".bd-example-modal-xl"
              [disabled]="isEnable"
            > -->
            <mat-icon  type="button"
              data-toggle="modal"
              role="button"
              data-target=".bd-example-modal-xl"
             >description</mat-icon>
              <!-- [disabled]="isEnable" -->
            <!-- </button> -->
          </td>
        </tr>
        <tr *ngIf="isEnable">
          <td>
            <mat-form-field style="width: 175px; margin-left: 50px">
              <mat-label>Contingency</mat-label>
              <input
                matInput
                placeholder="Contingency"
                type="number"
                formControlName="contigency"
                [readonly]="
                  mepStatus == 'REJECTED' ||
                  (mepContigency != 0 && mepStatus !== 'MODIFICATION-APPROVAL')
                "
                autocomplete="off"
                minlength="1"
                maxlength="3"
                size="45"
                pattern="[0-9]{1,3}"
                required
              />
            </mat-form-field>
          </td>
          <td>
            <mat-form-field style="width: 175px; margin-left: 50px">
              <mat-label>Total Amount </mat-label>
              <input
                matInput
                placeholder="Total Amount"
                type="number"
                [formControl]="totalconamount"
                readonly
              />
            </mat-form-field>
          </td>
        </tr>
      </table>
    </div>

    <div
      class="modal fade bd-example-modal-xl"
      tabindex="-1"
      role="dialog"
      aria-labelledby="myExtraLargeModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title" id="exampleModalLongTitle">Note Pad</h2>
          </div>
          <br />
          <div style="margin-left: 50px; width: 90%; height: 70%">
            <div>
              <div
                [ngxSummernote]="config"
                [ngxSummernoteDisabled]="editorDisabled"
                (blur)="onBlur()"
                (mediaDelete)="onDelete($event)"
                (summernoteInit)="summernoteInit($event)"
                formControlName="content"
              ></div>
            </div>
          </div>
          <br />
          <div class="modal-footer">
            <button
              type="button"
              style="border-radius: 40px; margin-left: 10px"
              class="btn btn-outline-primary"
              data-dismiss="modal"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>
   
    <!-- //PCA CONTIGENCY -->
    <!-- <div style="margin: 0 50px 50px 30px;">
            
            <mat-form-field style="width: 175px;margin-left: 50px;">
                <mat-label>Contingency</mat-label>
                <input matInput placeholder="Contingency" type="number" formControlName="contigency"
                    autocomplete="off" minlength="1" maxlength="3" size="45" pattern="[0-9]{1,3}" required>
            </mat-form-field>
            <mat-form-field style="width: 175px; margin-left: 50px;">
                <mat-label>Total Amount </mat-label>
                <input matInput placeholder="Total Amount" type="number" [formControl]="totalconamount" readonly>
            </mat-form-field>  
    </div> -->
    <!-- //PCA -->
     <div class="row m-3">
      <div class="col-md-6">
        <h2 style="margin-left: 4%">PCA Details</h2>

      </div>
      <div class="col-md-5 text-right">
        <button
        type="button"
        style="border-radius: 40px"
        *ngIf="!isEnable"
        class="btn btn-outline-success"
        (click)="addSection()"
      >
        <!-- <span class="fa fa-plus"></span> -->
         <mat-icon>add</mat-icon>
      </button>
      </div>
     </div>
   
    <div
      class="table-responsive"
      style="margin-top: 1%; width: 90%; margin-left: 50px"
    >
      <table class="table scrolltable table-bordered" fixed-header>
        <thead>
          <tr class="table_header" fixed-header>
            <th>S.No</th>
            <th>Commodity</th>
            <th>Description</th>
            <th>Amount</th>
            <th>Action</th>
          </tr>
        </thead>
        <ng-container
          formArrayName="mepdetails"
          *ngFor="let section of getSections(); let i = index"
        >
          <tr [formGroup]="section">
            <td style="text-align:center">{{ (currentPage - 1) * pageSize + i + 1 }}</td>
            <td style="text-align:center">
              <mat-form-field style="width: 250px;" (click)="getcommodityFK()">
                <mat-label>Commodity Name</mat-label>
                <input
                  #comInput
                  placeholder="Select Commodity"
                  matInput
                  formControlName="productcategory_id"
                  [matAutocomplete]="com"
                  [readonly]="isEnable"
                />
                <mat-autocomplete
                  #com="matAutocomplete"
                  [displayWith]="displayFncom"
                  (opened)="autocompletecomScroll()"
                >
                  <mat-option *ngIf="isLoading" class="is-loading"
                    >Loading...</mat-option
                  >
                  <ng-container *ngIf="!isLoading">
                    <mat-option *ngFor="let com of commodityList" [value]="com"
                      >{{ com.name }}
                    </mat-option>
                  </ng-container>
                </mat-autocomplete>
              </mat-form-field>
            </td>

            <td style="text-align:center">
              <mat-form-field>
                <input
                  matInput
                  placeholder="Description"
                  formControlName="desc"
                  autocomplete="off"
                  [readonly]="isEnable"
                  required
                />
              </mat-form-field>
            </td>

            <td style="text-align:center">
              <mat-form-field>
                <input
                  matInput
                  placeholder="Amount"
                  type="number"
                  name="totalamt"
                  [readonly]="
                    mepStatus == 'REJECTED' ||
                    (mepContigency != 0 && isBudgetedReadonly &&
                      mepStatus !== 'MODIFICATION-APPROVAL')
                  "
                  formControlName="totalamt"
                  autocomplete="off"
                  required
                />
              </mat-form-field>
            </td>
            <td style="text-align:center">
              <!-- <span (click)="removeSection(i)" class="material-icons"
                >delete</span
              > -->
              <mat-icon (click)="removeSection(i)">delete</mat-icon>
            </td>
          </tr>
        </ng-container>
        <tr>
          <th class="totaldisplay" colspan="3">Total Amount:</th>
          <td colspan="2">{{ sum | amountPipeCustom }}</td>
        </tr>
      </table>

      <!-- <div *ngIf="mepdetailsLen == 0; else paginationMEP" class="NodataAlign">No Records Found...</div> -->

      <!-- <ng-template #paginationMEP> -->

      <div class="row mb-4">
        <div class="col-md-6">
          <h3>Total Count : {{ mepdetailsLen }}</h3>
        </div>
        <div class="col-md-6 text-right cursor">
          <button
            mat-icon-button
            (click)="onPageChange(currentPage - 1)"
            [disabled]="currentPage === 1"
            color="primary"
          >
            <mat-icon>arrow_back </mat-icon>
          </button>
          <span> {{ currentPage }}</span>
          <button
            mat-icon-button
            (click)="onPageChange(currentPage + 1)"
            color="primary"
            [disabled]="currentPage >= getTotalPages()"
          >
            <mat-icon>arrow_forward </mat-icon>
          </button>
        </div>
      </div>

      <!-- </ng-template> -->
    </div>
    <div class="row mt-3 mb-5">
      <div class="col-md-11 text-right">
        <button
          *ngIf="
            isBudgetedReadonly == false ||
            mepStatus === 'PENDING-APPROVAL' ||
            (mepContigency === 0 && mepStatus === 'APPROVED') ||
            (mepContigency !== 0 && mepStatus === 'MODIFICATION-APPROVAL')
          "
          type="submit"
          style="border-radius: 40px"
          [disabled]="clicked"
          class="btn btn-outline-success"
          (click)="mepmakerSubmit()"
        >
          Submit
        </button>
        &nbsp; &nbsp;
        <button
          type="button"
          class="btn btn-outline-primary"
          style="border-radius: 40px"
          (click)="onCancelClick()"
        >
          Cancel
        </button>
      </div>
    </div>
  </form>
</div>
<!-- <pre>
    {{ MEPmakerForm.value | json }}
</pre> -->

<ngx-spinner
  bdColor="rgba(0, 0, 0, 0.8)"
  size="default"
  type="line-scale-party"
>
  <p style="color: white">Please Wait.</p>
</ngx-spinner>

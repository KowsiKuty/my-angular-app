<div class="container">
    <h1 style="font-size: 23px;font-family: 'Times New Roman', Times, serif;color: blue;">{{enb_data | titlecase }} Approval</h1>
</div><hr />
<div class="container">
    <form [formGroup]="approveform">
        <div class="row">
            <div class="col-md-3">
                <mat-form-field style="width: 250px;">
                    <mat-label>{{enb_data  | titlecase}} Header Name</mat-label>
                    <input type="text" matInput formControlName="name" readonly (keypress)="kyenbdata($event)">
                </mat-form-field>
            </div>
            <div class="col-md-3">
                <mat-form-field style="width: 250px;">
                    <mat-label>{{enb_data | titlecase}} From Period</mat-label>
                    <input matInput [matDatepicker]="pick" formControlName="fromperiod" readonly>
                    <mat-datepicker-toggle [for]="pick" matSuffix></mat-datepicker-toggle>
                    <mat-datepicker #pick></mat-datepicker>
                </mat-form-field>
            </div>
            <div class="col-md-3">
                <mat-form-field style="width: 250px;">
                    <mat-label>{{enb_data | titlecase}} To Period</mat-label>
                    <input matInput [matDatepicker]="picker" formControlName="toperiod" readonly>
                    <mat-datepicker-toggle [for]="picker" matSuffix></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                </mat-form-field>
            </div>
        </div>
        <div class="row">
            <div class="col-md-3">
                <mat-form-field style="width: 250px;">
                    <mat-label>Supplier Name</mat-label>
                    <input type="text"  matInput formControlName="suppliername" readonly (keypress)="kyenbdata($event)">
                </mat-form-field>
            </div>
            <div class="col-md-3">
                <mat-form-field style="width: 250px;">
                    <mat-label>Service Period</mat-label>
                    <input type="text" matInput formControlName="serviceperiod" readonly>
                </mat-form-field>
            </div>
            <div class="col-md-3">
                <mat-form-field style="width: 250px;">
                    <mat-label>{{enb_data | titlecase}} Total</mat-label>
                    <input type="number" matInput formControlName="amctotal" readonly (keypress)="kyenbdata($event)">
                </mat-form-field>
            </div>


            <!-- <div class="col-md-3">
                <button class="edit" mat-fab color="success" matTooltip="Download File" (click)="approval_download_file(id)">
                    <mat-icon  style="color:black">download</mat-icon>
                </button>
                <button class="edits" mat-fab color="success"  matTooltip="View File" data-target="#my-modal" data-toggle="modal" (click)="approval_view_file(id)">
                    <mat-icon  style="color:black">visibility</mat-icon>
                </button>
            </div> -->
        </div>

        <br />
        <div class="row">
            <div class="col-md-3">
                <mat-form-field style="width: 250px;">
                    <mat-label>Periodic Mail</mat-label>
                    <input type="text"  matInput formControlName="periodicmail" readonly (keypress)="kyenbdata($event)">
                </mat-form-field>
            </div>
        </div>
        <!-- <button class="btn btn-outline-success" style="border-radius: 100%;float: right;"><i class="bi bi-download"></i></button> -->
        <!-- <button class="btn btn-outline-success" style="border-radius: 100%;float: right;"><span class='material-icons'>download</span></button> -->
        <!-- <span class="material-icons">download_for_offline</span> -->
        <!-- <button class="edit" mat-fab color="success"  >
            <mat-icon  style="color:black">download</mat-icon>
            </button>
        <br/> -->
        <table class="table table-bordered">
            <thead class="table_header">
                <tr>
                    <th>S.No</th>
                    <th>Branch Name</th>
                    <th>Product Name</th>
                    <th>Asset Barcode</th>
                    <th>Asset Category</th>
                    <th>Asset Serial Number</th>
                    <th>{{enb_data}} Details Amount</th>
                    <th>Remarks</th>
                    <!-- <th>View/Download</th> -->
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let d of summarydata;let i=index">
                    <td>{{(presentpage-1)*pageSize+i+1}}</td>
                    <td>{{d['branch_id'].code+' - '+d['branch_id'].name}}</td>
                    <td>{{d['product_id'].name?d['product_id'].name:'-'}}</td>
                    <td>{{d.assetdetails_id}}</td>
                    <td>{{d.apcategory?d.apcategory.name:'-'}}
                    <td>{{d.assetserialno ? d.assetserialno:'-'}}</td>
                    <td>{{d.amount|  number:'1.2-2'}}</td>
                    <td>{{d.remarks}}</td>
                    <!-- <td ><span class="material-icons" 
                        (click)="pdfpup(d)">
                            visibility
                        </span>
                        <span class="material-icons" (click)="PDfDownload(d)">
                            picture_as_pdf
                        </span>
                    </td> -->
                </tr>
                <tr *ngIf="summarydata.length==0">
                    <td colspan="5">
                        No Records Found..
                    </td>
                </tr>
                <tr>
                    <!--<td class="text-right" colspan="5">
                        <div class="col-sm-12" style="font-size: small; text-align: right;">
                            <button mat-icon-button [disabled]="!has_previous_approval" color="primary" (click)="previousClick()">
                                <mat-icon>arrow_back</mat-icon>
                          </button>
                            {{presentpagenew}}
                           <button mat-icon-button [disabled]="!has_next_approval" color="primary" (click)="nextClick()">
                                <mat-icon>arrow_forward</mat-icon>
                            </button>
                        </div>
                    </td>-->
                   <td colspan="5">
                       <div style="float: right;">
                            <button type="button" mat-icon-button [disabled]="!has_previousnew"color="primary" (click)="newpreviousClick()"><mat-icon>arrow_back</mat-icon></button>
                            {{presentpage}}
                            <button type="button" mat-icon-button [disabled]="!has_nextnew"color="primary" (click)="newnextClick()"><mat-icon>arrow_forward</mat-icon></button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <br />
        <br />
        <div  [formGroup]="approveform">
            <div class="row">
                <!-- <div class="col-md-4" >
                    <mat-form-field appearance="outline" style="width: 250px;">
                        <mat-label>Remarks</mat-label>
                        <input  type="text" matInput autocomplete="off"  formControlName="remarks" required />
                    </mat-form-field>
                    </div> -->
        
        <div class="col-md-4" >
        <mat-radio-group formControlName="check" (selected)="eventHandler($event)">
            <mat-radio-button value="Approve" id="radio1" tabindex="0" [checked]="isapproveChecked" (keyup)="eventclick($event,'Approve')" (click)="eventclick($event,'Approve')">Approve</mat-radio-button>
            <mat-radio-button value="Reject"  id="radio2" tabindex="0" [checked]="isrejectChecked" (keyup)="eventclick($event,'Reject')" (click)="eventclick($event,'Reject')"  >Reject</mat-radio-button>
        </mat-radio-group>
        </div>
        <div class="col-md-4" *ngIf="isapproveChecked">
            <mat-form-field appearance="outline" style="width: 250px;">
                <mat-label>Remarks</mat-label>
                <input  type="text" matInput autocomplete="off"  formControlName="remarks"  />
            </mat-form-field>
            </div>

            <div class="col-md-4" *ngIf="isrejectChecked">
                <mat-form-field appearance="outline" style="width: 250px;">
                    <mat-label>Remarks</mat-label>
                    <input  type="text" matInput autocomplete="off"  formControlName="remarks"  required/>
                </mat-form-field>
                </div>
        <div class="col-md-4"  >
            
                <form [formGroup]="myForm">
                    <div formArrayName="fileInputs">
                      <div *ngFor="let section of getSections(myForm); let i = index">
                <h4  *ngIf="isapproveChecked" style="color: blue;font-family: 'Times New Roman', Times, serif;font-size: 23px;">File Upload</h4>   
                <h4  *ngIf="isfileviewChecked" style="color: blue;font-family: 'Times New Roman', Times, serif;font-size: 23px;">File Download</h4>      
                <tr [formGroupName]="i">
                    <td style="border:0px" *ngIf="isapproveChecked">
                    <button type="button" mat-icon-button>   
                    <input #fileInput id="uploadFile" type="file" multiple style="width: 108px;" hidden  (click)="getheaderedit(i)" (change)="getFileDetails(i,$event)" 
                        >
                    </button>
    
                       <button type="button" mat-icon-button> 
                        <i  (click)="fileInput.click()"  class="fa fa-cloud-upload" matTooltip="Upload file" matTooltipClass="custom-tooltipnew" aria-hidden="true" style="font-size: 25px;color: rgb(11, 11, 11);width:15px"></i>
                    
                    </button>
                  
                </td>
    
                    <td style="border:0px"  *ngIf="myForm.value?.fileInputs?.length > 0">
                       
                        <div>

                            <button type="button" mat-icon-button (keypress)="getfiledetails(myForm.value?.file_key,i)"> 
                        <span matTooltip="view" matTooltipClass="custom-tooltipnew" class="fa fa-eye create"
                        (click)="getfiledetails(myForm.value?.file_key,i)"   
                       data-target="#showattachmentpopup" data-toggle="modal"
                       style="cursor: pointer;color:rgb(14, 16, 15);margin-left: 15px;width:5px" ></span>
                    </button>
                    </div>
                  </td>
                  
                 
    
    
                </tr>
                </div>
                </div>
                </form>
            

        </div>
            </div>
        </div>
    </form>
    <div class="text-center">
        <button type="button" (click)="approvedata()" class="btn btn-outline-success" style="border-radius: 40px;height: 40px;margin-bottom: 50px;">Submit</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <button type="button" class="btn btn-outline-danger" routerLink="/sms/smsapprovalsummary" style="border-radius: 40px;height: 40px;margin-bottom: 50px;">Cancel</button>
    </div>
</div>
<ng-template #viewfiledata>
    <div *ngIf="pdfview">
        <div style="float: right;">
            <button type="button" mat-icon-button (click)="zoom_in()"><mat-icon>zoom_in</mat-icon></button>
            <button type="button" mat-icon-button (click)="zoom_out()"><mat-icon>zoom_out</mat-icon></button>
        </div>
        <pdf-viewer *ngIf="pdfSrc !=undefined" [src]="pdfSrc"
            [render-text]="true"
            [original-size]="false"
            [zoom]="zoom_to"
            style="width: 795px; height: 318px">
        </pdf-viewer>
    </div>
    <div *ngIf="imgview">
        <img [src]="imgurl" alt="Failed To Load">
    </div>
    <div class="text-right">
        <button type="button" class="btn btn-outline-danger" (click)="closedialogdata()">Close</button>
    </div>
</ng-template>
    

<div>
    <div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true" 
        id="showattachmentpopup">
        <div class="modal-dialog modal-lg " style="width: 70%;">
            <div class="modal-content">
                <div class="modal-header" style="background: rgba(23, 204, 23, 0.288);">
                    <h2 class="modal-title" style="color:black ;text-align: center;font-weight: bold;">Attachments
                    </h2>
                    <button type="button" class="close" data-dismiss="modal" #closedbuttons aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div style="margin-left: 50px;margin-right: 80%;margin-top: 2%; width: 80%;">
                    <div class="container">
                        <div class="row">
                            <div class="table-responsive" style="width:100%;margin-top: 1%;">
                                <h3 style="font-weight: bold;">Currently Attached Files</h3>
                                <table class="table table-bordered" fixed-header style="width: 99%;margin-top: 10px;">
                                    <thead class="table_header" style="text-align: left;">
                                    <tr>
                                        <th style="text-align: center;">S.No</th>
                                        <th style="text-align: center;">File Name</th>
                                        <th style="text-align: center;">View</th>
                                        <th style="text-align: center;">Delete</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                         <tr  *ngFor="let files of file_process_data['file'+fileindex]; let index = index">
                                            <td>{{index+1}}</td>
                                            <td>
                                                
                                                {{files?.name}} 
                                            
                                            </td>
                                            <td style="text-align: center;" >
                                            <button class="fa fa-external-link" title="View" aria-hidden="true"  mat-icon-button style="color:blue;font-size: 24px;margin-left: 20px;" (click)="filepreview(files)" data-toggle="modal"
                                            data-target="#my-modalpreview"></button>
                                                </td>
                                            <td style="text-align: center;">
                                                
                                                <button (click)="deletefileUpload(myForm,index)" mat-icon-button
                                                   >
                                                    <mat-icon title="Delete"  matTooltipClass="custom-tooltipnew">delete
                                                    </mat-icon>
                                                </button>
                                            </td>
                                         </tr>
                                        
                                    </tbody>
                                </table>
                               
                                
                            <br>
                            <h3 style="font-weight: bold;">SMS Maker Attached Files</h3>
                                <table class="table table-bordered" fixed-header style="width: 99%;margin-top: 10px;">
                                    <thead class="table_header" style="text-align: left;">

                                        <tr>
                                            <th style="text-align: center;">S.No</th>
                                            <th style="text-align: center;">File Name</th>
                                            <th style="text-align: center;">View</th>
                                            <th style="text-align: center;">Download</th>
                                            <!-- <th style="text-align: center;">Delete </th> -->


                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let attach of filedatalist; index as i">
                                            <td style="text-align: center;">{{i+1}}</td>
                                            <td>{{attach.name}}</td>
                                            <td style="text-align: center;" >
                                                <button class="fa fa-external-link" matTooltip="View" aria-hidden="true" mat-icon-button style="color:blue;font-size: 24px;margin-left: 20px;" data-target="#my-modal" data-toggle="modal" (click)="approval_view_file(attach.id,attach.name)"></button>
                                                </td>
                                          

                                            <td style="text-align: center;">
                                                <button class="btn btn-outline-primary" type="submit" mat-icon-button
                                                    (click)="approval_download_file(attach.id,attach.name)"
                                                    style="border-radius:40px;margin-left: 15px;" color="primary">
                                                    <button matTooltip="Download" matTooltipClass="custom-tooltipnew" mat-icon-button class="fa fa-download" matTooltipClass="custom-tooltipnew"
                                                        aria-hidden="true"></button>
                                                </button>
                                            </td>
                                            <!-- <td style="text-align:center">
                                                <mat-icon style="color: black;cursor: pointer;"
                                                    (click)="fileDeletes(attach.id,i)">delete</mat-icon>
                                            </td> -->
                                        </tr>
                                    </tbody>
                                </table>

                            </div>
                            <tr>
                                <td>

                                    <button type="button" class="btn btn-light" style="border-radius:7px;margin-left:220px;
                                                            border-color: black; margin-bottom: 20px;
                                                            background-color: white;" (click)="fileback()">Back</button>

                                </td>
                            </tr>
                        </div>
                    </div>


                </div>
            </div>
        </div>
    </div>
</div>
<div *ngIf="showimageHeaderPreview" id="my-modalpreview" class="modal fade" aria-labelledby="my-modalLabel"
    aria-hidden="true" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-xl" data-dismiss="modal" style="width: 60%;height: 80%;">
        <div class="modal-content">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            <div class="modal-body">
                <img src="{{jpgUrls}}" class="img-responsive" style="width: 100%;">

            </div>
        </div>
    </div>
</div>

<div *ngIf="showimageHeaderPreviewPDF" id="my-modalpreview" class="modal fade" aria-labelledby="my-modalLabel"
    aria-hidden="true" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header" style="background: rgba(23, 204, 23, 0.288);">
                <h2 class="modal-title"> SMS Attachments</h2>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <pdf-viewer [src]="pdfurl" [original-size]="false" [render-text]='false' [show-borders]="true"
                [fit-to-page]="true" [show-all]="true" style="display: block; height: 600px;" [fit-to-page]="true">
            </pdf-viewer>
        </div>
    </div>
</div>
<div *ngIf="showimageHeaderAPI" id="my-modal" class="modal fade" aria-labelledby="my-modalLabel" aria-hidden="true"
tabindex="-1" role="dialog">
<div class="modal-dialog modal-xl" data-dismiss="modal" style="width: 60%;height: 80%;">
    <div class="modal-content">
        <div class="modal-header" style="background:#e6ffe6">
            <h2 class="modal-title">SMS Maker Attachments</h2>
                <button type="button" class="text-right" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
        </div>
        <div class="modal-body">
            <img src="{{jpgUrlsAPI}}" class="img-responsive" style="width: 100%;">
        
        </div>
    </div>
</div>
</div>
<div *ngIf="showimagepdf" id="my-modal" class="modal fade" aria-labelledby="my-modalLabel" aria-hidden="true"
tabindex="-1" role="dialog">
<div class="modal-dialog modal-xl">
    <div class="modal-content">
        <div class="modal-header" style="background:#e6ffe6">
            <h2 class="modal-title">SMS Maker Attachments</h2>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <pdf-viewer [src]="pdfurl" [original-size]="false" [render-text]='false' [show-borders]="true"
            [fit-to-page]="true" [show-all]="true" style="display: block; height: 600px;" [fit-to-page]="true">
        </pdf-viewer>
    </div>
</div>

</div> 
